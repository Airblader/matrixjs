function d(a){throw a;}var k=!0,l=null,m=!1,p=this;Math.random();function q(a,b){var c=a.split("."),e=p;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function r(){this.constructor=l;this.c=function(){return l};this.e=function(){return this};this.a=function(){return{rows:l,b:l}};d(Error("MatrixCommon cannot be instantiated"))}q("MatrixCommon",r);function s(){d(Error("This cannot be instantiated"))}q("MatrixUtils",s);function u(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q("MatrixError",u);
var v={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};u.ErrorCodes=v;
function w(a){var b=[].slice.call(arguments),c,e,f=[];this.c=function(a,b){return f[e*(a-1)+b-1]};this.e=function(a,b,c){f[e*(a-1)+b-1]=c;return this};this.a=function(){return{rows:c,b:e}};this.D=function(){return f};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;e=-1;for(var a=0;a<b[0].length;a++)b[0][a].length!==e&&-1!==e&&d(new u(v.INVALID_PARAMETERS,"Number of columns must be the same for all rows")),x(b[0][a])||d(new u(v.INVALID_PARAMETERS,
"Elements must be numbers")),e=Math.max(e,b[0][a].length),f=f.concat(b[0][a])}else if(1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||y(b[0][0]))){x(b[0])||d(new u(v.INVALID_PARAMETERS,"Elements must be numbers"));f=b[0];var a=b[1],g=b[2];!y(a)&&!y(g)?a=g=Math.sqrt(f.length):!y(a)&&A(g)?a=f.length/g:A(a)&&!y(g)&&(g=f.length/a);(!A(a)||!A(g))&&d(new u(v.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given"));c=a;e=g}else 1===b.length&&A(b[0])?(c=b[0],e=b[0],f=B(c*
e,0)):2===b.length&&A(b[0])&&A(b[1])?(c=b[0],e=b[1],f=B(c*e,0)):d(new u(v.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",w);w.prototype=Object.create(r.prototype);w.prototype.constructor=w;function C(){d(Error("Not yet implemented."))}q("SparseMatrix",C);C.prototype=Object.create(r.prototype);C.prototype.constructor=C;
q("Vector",function(a){[].slice.call(arguments);var b=[];this.c=function(a,e){return b[e-1]};this.e=function(a,e,f){b[e-1]=f;return this};this.a=function(){return{rows:1,b:b.length}};return this});var D={stringify:{V:"\r\n",H:"\t"},m:{mode:"both"},n:{K:0},t:{which:"max"},random:{R:0,Q:1,S:k}};r.options=D;r.prototype.d=function(a,b){var c=this.constructor;if(a.j&&this.s())for(var e=0;e<a.j.length;e++)a.j[e].s()||(c=w);return new (c.bind.apply(c,[l].concat([].slice.call(arguments,1))))};
r.prototype.get=function(a,b){this.f(a,b)||d(new u(v.OUT_OF_BOUNDS));return this.c(a,b)};r.prototype.get=r.prototype.get;r.prototype.set=function(a,b,c){this.f(a,b)||d(new u(v.OUT_OF_BOUNDS));y(c)||d(new u(v.INVALID_PARAMETERS,"Value has to be a number"));return this.e(a,b,c)};r.prototype.set=r.prototype.set;r.prototype.O=function(a,b){b=E(b,m);this.f(a,l)||d(new u(v.OUT_OF_BOUNDS));return F(this,a,b)};r.prototype.getRow=r.prototype.O;
function F(a,b,c){for(var e=[],f=a.a().b,h=1;h<=f;h++)e.push(a.c(b,h));return c?a.d({},e,1):e}r.prototype.X=function(a,b){b=H(b);this.f(a,l)||d(new u(v.OUT_OF_BOUNDS));b.length!==this.a().b&&d(new u(v.INVALID_PARAMETERS,"Wrong number of columns in row."));return I(this,a,b)};r.prototype.setRow=r.prototype.X;function I(a,b,c){for(var e=a.a().b,f=1;f<=e;f++)a.e(b,f,c[f-1]);return a}r.prototype.N=function(a,b){b=E(b,m);this.f(l,a)||d(new u(v.OUT_OF_BOUNDS));return J(this,a,b)};
r.prototype.getColumn=r.prototype.N;function J(a,b,c){for(var e=[],f=a.a().rows,h=1;h<=f;h++)e.push(a.c(h,b));return c?a.d({},e,l,1):e}r.prototype.W=function(a,b){b=H(b);this.f(l,a)||d(new u(v.OUT_OF_BOUNDS));b.length!==this.a().rows&&d(new u(v.INVALID_PARAMETERS,"Wrong number of rows in column"));return K(this,a,b)};r.prototype.setColumn=r.prototype.W;function K(a,b,c){for(var e=a.a().rows,f=1;f<=e;f++)a.e(f,b,c[f-1]);return a}
r.prototype.l=function(a){var b=this.a();a=a.a();return b.rows===a.rows&&b.b===a.b};r.prototype.isSameSizeAs=r.prototype.l;r.prototype.s=function(){return this instanceof C};r.prototype.isSparse=r.prototype.s;r.prototype.i=function(){return 1===this.r("min")};r.prototype.isVector=r.prototype.i;r.prototype.h=function(){return this.a().rows===this.a().b};r.prototype.isSquare=r.prototype.h;
r.prototype.P=function(){this.h()||d(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.c(b,c)!==this.c(c,b))return m;return k};r.prototype.isSymmetric=r.prototype.P;
r.prototype.m=function(a){a=L(a,D.m.mode);this.h()||d(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return M(this,m);case "upper":return M(this,k);case "both":return M(this,k)||M(this,m);default:d(new u(v.INVALID_PARAMETERS,"Mode not supported"))}};r.prototype.isTriangular=r.prototype.m;function M(a,b){for(var c=b?1:-1,e,f,h=a.a().rows,g=1;g<h;g++){e=a.diag(c*g);f=e.length;for(var n=0;n<f;n++)if(0!==e[n])return m}return k}
r.prototype.copy=function(){var a=this.a();return this.d({},this.o(),a.rows,a.b)};r.prototype.copy=r.prototype.copy;r.prototype.size=function(){var a=this.a();return a.rows*a.b};r.prototype.size=r.prototype.size;r.prototype.r=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.b;case "max":return Math.max(b.rows,b.b);case "min":return Math.min(b.rows,b.b);default:d(new u(v.INVALID_PARAMETERS,"Parameter must match a known value"))}};
r.prototype.dim=r.prototype.r;r.prototype.add=function(a){var b=this.a(),c=b.rows,b=b.b;if(1<arguments.length)return c=[].slice.call(arguments),this.add.apply(this.add(c.shift()),c);this.l(a)||d(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=this.d({j:[a]},c,b),f,h,g=1;g<=c;g++){f=F(this,g,m);h=F(a,g,m);for(var n=0;n<b;n++)f[n]+=h[n];I(e,g,f)}return e};r.prototype.add=r.prototype.add;
r.prototype.u=function(a){var b=this.a().rows,c=this.a().b;if(1<arguments.length)return b=[].slice.call(arguments),this.u.apply(this.u(b.shift()),b);this.l(a)||d(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=this.d({j:[a]},b,c),f,h,g=1;g<=b;g++){f=F(this,g,m);h=F(a,g,m);for(var n=0;n<c;n++)f[n]-=h[n];I(e,g,f)}return e};r.prototype.subtract=r.prototype.u;
r.prototype.scale=function(a){y(a)||d(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().b,e=this.d({},b,c),f,h=1;h<=b;h++){f=F(this,h,m);for(var g=0;g<c;g++)f[g]*=a;I(e,h,f)}return e};r.prototype.scale=r.prototype.scale;
r.prototype.multiply=function(a){var b=this.a(),c=b.rows,b=b.b,e=a.a().b;b!==a.a().rows&&d(new u(v.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=this.d({j:[a]},c,e),h=1;h<=c;h++)for(var g=1;g<=e;g++){for(var n=0,t=F(this,h,m),z=J(a,g,m),G=0;G<b;G++)n+=t[G]*z[G];f.e(h,g,n)}return f};r.prototype.multiply=r.prototype.multiply;r.prototype.C=function(){for(var a=this.a(),b=this.d({},a.b,a.rows),c=1;c<=a.rows;c++)K(b,c,F(this,c,m));return b};r.prototype.transpose=r.prototype.C;
r.prototype.trace=function(){this.h()||d(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=this.c(c,c);return b};r.prototype.trace=r.prototype.trace;
r.prototype.q=function(){var a=0,b=this.copy(),c,e,f,h,g,n=this.a().rows,t=this.a().b,z;for(f=1;f<=n;f++){e=0;g=-1;h=J(b,f,m);for(c=f;c<=n;c++)z=Math.abs(h[c-1]),z>=g&&(e=c,g=z);0===h[e-1]&&d(new u(v.MATRIX_IS_SINGULAR));e!==f&&(c=F(b,e,m),I(b,e,F(b,f,m)),I(b,f,c),a++);h=F(b,f,m);for(c=f+1;c<=n;c++){g=F(b,c,m);for(e=f;e<t;e++)g[e]-=h[e]*g[f-1]/h[f-1];g[f-1]=0;I(b,c,g)}}b.Z=a;return b};r.prototype.decomposeLU=r.prototype.q;
r.prototype.J=function(){var a,b,c,e=this.a().rows;this.h()||d(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));if(this.m())b=1,c=this.diag();else{try{a=this.q()}catch(f){if(f.code&&f.code===v.MATRIX_IS_SINGULAR)return 0;d(f)}b=Math.pow(-1,a.Z);c=a.diag()}for(a=0;a<e;a++)b*=c[a];return b};r.prototype.det=r.prototype.J;
r.prototype.inverse=function(){this.h()||d(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.p(N(this.a().rows)),b,c,e,f,h,g,n,t,z;try{a=a.q();t=a.a().rows;z=a.a().b;for(f=t;1<f;f--){c=F(a,f-1,m);b=F(a,f,m);n=c[f-1]/b[f-1];e=[];for(g=0;g<z;g++)e[g]=c[g]-b[g]*n;I(a,f-1,e)}for(h=1;h<=t;h++){b=F(a,h,m);e=[];for(g=0;g<z;g++)e[g]=b[g]/b[h-1];I(a,h,e)}}catch(G){d(new u(v.MATRIX_IS_SINGULAR))}return a.B(1,a.a().rows,this.a().b+1,a.a().b)};r.prototype.inverse=r.prototype.inverse;
r.prototype.B=function(a,b,c,e){(!this.f(a,c)||!this.f(b,e)||a>b||c>e)&&d(new u(v.OUT_OF_BOUNDS));for(var f=this.d({},b-a+1,e-c+1),h=a;h<=b;h++)I(f,h-a+1,F(this,h,m).slice(c-1,e));return f};r.prototype.submatrix=r.prototype.B;r.prototype.p=function(a){var b=this.a().b,c=a.a().b;this.a().rows!==a.a().rows&&d(new u(v.INVALID_PARAMETERS,"Number of rows must match"));for(var e=this.d({j:[a]},this.a().rows,b+c),f=1;f<=b;f++)K(e,f,J(this,f,m));for(b=1;b<=c;b++)K(e,b+this.a().b,J(a,b,m));return e};
r.prototype.augment=r.prototype.p;r.prototype.L=function(a){var b=this.a().rows;(!this.i()||!a.i()||1!==this.a().b||1!==a.a().b)&&d(new u(v.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&d(new u(v.DIMENSION_MISMATCH));for(var c=0,e=1;e<=b;e++)c+=this.c(e,1)*a.c(e,1);return c};r.prototype.dot=r.prototype.L;r.prototype.round=function(){return this.n(0)};r.prototype.round=r.prototype.round;
r.prototype.n=function(a){a=y(a)?a:D.n.K;var b=Math.pow(10,a);return this.g(function(a){return Math.round(a*b)/b})};r.prototype.roundTo=r.prototype.n;r.prototype.abs=function(){return this.g(function(a){return Math.abs(a)})};r.prototype.abs=r.prototype.abs;
r.prototype.I=function(a){(!this.i()||!a.i()||3!==this.a().rows||3!==a.a().rows)&&d(new u(v.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return this.d({},[[this.c(2,1)*a.c(3,1)-this.c(3,1)*a.c(2,1)],[this.c(3,1)*a.c(1,1)-this.c(1,1)*a.c(3,1)],[this.c(1,1)*a.c(2,1)-this.c(2,1)*a.c(1,1)]])};r.prototype.cross=r.prototype.I;r.prototype.G=function(a){a=H(a);for(var b=this.a().rows,c=this.d({},b+1,this.a().b),e=1;e<=b;e++)I(c,e,F(this,e,m));I(c,b+1,a);return c};
r.prototype.addRow=r.prototype.G;r.prototype.F=function(a){return this.copy().p(this.d({},H(a),l,1))};r.prototype.addColumn=r.prototype.F;r.prototype.contains=function(a,b){b=y(b)?b:0;var c=this.a().rows,e=this.a().b,f;(!y(a)||!y(b))&&d(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var h=1;h<=c;h++){f=F(this,h,m);for(var g=0;g<e;g++)if(0===b){if(f[g]===a)return k}else if(Math.abs(f[g]-a)<=b)return k}return m};r.prototype.contains=r.prototype.contains;
r.prototype.stringify=function(a,b){a=L(a,D.stringify.V);b=L(b,D.stringify.H);for(var c=[],e,f=this.a().rows,h=1;h<=f;h++)e=F(this,h,m),c.push(e.join(b));return c.join(a)};r.prototype.stringify=r.prototype.stringify;r.prototype.M=function(a){var b=this.a().rows,c=this.a().b,e,f;if(!this.l(a))return m;for(var h=1;h<=b;h++){e=F(this,h,m);f=F(a,h,m);for(var g=0;g<c;g++)if(e[g]!==f[g])return m}return k};r.prototype.equals=r.prototype.M;
r.prototype.g=function(a,b){b=b||O.all;"function"!==typeof a&&d(new u(v.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&d(new u(v.INVALID_PARAMETERS,"Filter must be a function"));var c,e;c=this.a();for(var f=c.rows,h=c.b,g=this.d({},f,h),n=1;n<=f;n++){e=F(this,n,m);for(var t=1;t<=h;t++)c=e[t-1],b(c,n,t)&&(e[t-1]=a(c,n,t));I(g,n,e)}return g};r.prototype.fun=r.prototype.g;r.prototype.Y=function(a){return this.g(a,O.nonZero)};r.prototype.spfun=r.prototype.Y;
r.prototype.T=function(){return this.g(P.exp,l)};r.prototype.pw_exp=r.prototype.T;r.prototype.U=function(a){return this.g(function(b){return Math.pow(b,a)},l)};r.prototype.pw_pow=r.prototype.U;
r.prototype.t=function(a,b){a=L(a,D.t.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.k(Number(b));case "frobenius":return this.k(2);case "rows":case "rowsum":return this.A();case "columns":case "columnsum":return this.w();case "max":return this.z();default:d(new u(v.INVALID_PARAMETERS,"Norm not supported"))}};r.prototype.norm=r.prototype.t;
r.prototype.k=function(a){A(a)||d(new u(v.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,e=this.a().b,f,h=1;h<=c;h++){f=F(this,h,m);for(var g=0;g<e;g++)b+=Math.pow(Math.abs(f[g]),a)}return Math.pow(b,1/a)};r.prototype.pnorm=r.prototype.k;r.prototype.z=function(){for(var a=0,b=this.a().rows,c=this.a().b,e,f=1;f<=b;f++){e=F(this,f,m);for(var h=0;h<c;h++)a=Math.max(a,Math.abs(e[h]))}return a};r.prototype.maxnorm=r.prototype.z;
r.prototype.A=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,F(this,c,k).k(1));return a};r.prototype.rownorm=r.prototype.A;r.prototype.w=function(){for(var a=0,b=this.a().b,c=1;c<=b;c++)a=Math.max(a,J(this,c,k).k(1));return a};r.prototype.columnnorm=r.prototype.w;r.prototype.diag=function(a){a=y(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var e=0===c?this.a().b-a:this.a().rows-c;0>=e&&d(new u(v.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(this.c(f+c,f+a));return b};
r.prototype.diag=r.prototype.diag;r.prototype.f=function(a,b){return(!y(a)||1<=a&&a<=this.a().rows)&&(!y(b)||1<=b&&b<=this.a().b)};r.prototype.isInRange=r.prototype.f;r.prototype.o=function(){for(var a=this.a().rows,b=[],c=1;c<=a;c++)b=b.concat(F(this,c,m));return b};r.prototype.toArray=r.prototype.o;w.prototype.o=function(){return[].slice.call(this.D())};w.prototype.toArray=w.prototype.o;w.zeros=function(a,b){b=y(b)?b:a;return new w(a,b)};
w.ones=function(a,b){b=y(b)?b:a;for(var c=new w(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)c.e(e,f,1);return c};function N(a){for(var b=new w(a,a),c=1;c<=a;c++)b.e(c,c,1);return b}w.eye=N;w.diag=function(a,b){a=H(a);b=y(b)?b:0;for(var c=new w(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),h=c.a().rows-Math.abs(b),g=1;g<=h;g++)c.e(g+e,g+f,a[g-1]);return c};w.diag=w.diag;
w.random=function(a,b,c,e,f){b=y(b)?b:a;c=y(c)?c:D.random.R;e=y(e)?e:D.random.Q;f=E(f,D.random.S);var h=new w(a,b);e=e-c+(f?1:0);for(var g,n=1;n<=a;n++)for(var t=1;t<=b;t++)g=c+Math.random()*e,f&&(g|=0),h.e(n,t,g);return h};function y(a){return"number"===typeof a}function A(a){return y(a)&&(a|0)===a}function x(a){for(var b=0;b<a.length;b++)if(!y(a[b]))return m;return k}s.linspace=function(a,b,c){c=y(c)?c:1;for(var e=[];a<=b;a+=c)e.push(a);return e};
function B(a,b){for(var c=[],e=1;e<=a;e++)c[e-1]=b;return c}s.repeat=B;function H(a){if(!(a instanceof r))return a;a.i()||d(new u(v.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.r("max")!==a.a().rows&&(b=b.C());a=[];for(var c=b.a().rows,e=1;e<=c;e++)a.push(b.c(e,1));return a}function L(a,b){return"string"===typeof a?a:b}function E(a,b){return"boolean"===typeof a?a:b}var O={all:function(){return k},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};
s.filters=O;var P={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};s.applicators=P;Array.prototype.v=function(a,b){return new w(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.v);Array.prototype.$=function(a){a=E(a,m);return new w(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.$);
String.prototype.v=function(a,b){a=L(a,"\r\n");b=L(b,"\t");for(var c=this.split(a),e,f=0,h=new w(0),g=0;g<c.length;g++){e=c[g].split(b);0===f&&(f=e.length,h=new w(c.length,f));e.length!==f&&d(new u(v.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var n=1;n<=f;n++)h.e(g+1,n,Number(e[n-1]))}return h};q("String.prototype.toMatrix",String.prototype.v);
