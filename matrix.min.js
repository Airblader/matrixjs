function f(a){throw a;}var k=!0,l=null,m=!1,p=this;Math.random();function q(a,b){var c=a.split("."),d=p;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&void 0!==b?d[e]=b:d=d[e]?d[e]:d[e]={}};function r(){var a=window.console&&window.console.log||{log:function(){}};this.b=function(b,c){a.log("Tried to call MatrixCommon::___get("+b+", "+c+")");return l};this.d=function(b,c,d){a.log("Tried to call MatrixCommon::___set("+b+", "+c+", "+d+")");return this};this.a=function(){a.log("Tried to call MatrixCommon::___dim()");return{rows:-1,c:-1}};f(Error("MatrixCommon cannot be instantiated"))}q("MatrixCommon",r);function t(){f(Error("This cannot be instantiated"))}q("MatrixUtils",t);
function u(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q("MatrixError",u);var v={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular"};u.ErrorCodes=v;
function w(a){var b=[].slice.call(arguments),c,d,e=[];this.b=function(a,b){return e[d*(a-1)+b-1]};this.d=function(a,b,c){e[d*(a-1)+b-1]=c;return this};this.a=function(){return{rows:c,c:d}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;d=-1;for(var a=0;a<b[0].length;a++){b[0][a].length!==d&&-1!==d&&f(new u(v.INVALID_PARAMETERS,"Number of columns must be the same for all rows"));x(b[0][a])||f(new u(v.INVALID_PARAMETERS,"Elements must be numbers"));
d=Math.max(d,b[0][a].length);for(var h=0;h<b[0][a].length;h++)e.push(b[0][a][h])}}else 1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||y(b[0][0]))?(x(b[0])||f(new u(v.INVALID_PARAMETERS,"Elements must be numbers")),e=b[0],a=b[1],h=b[2],!y(a)&&!y(h)?a=h=Math.sqrt(e.length):!y(a)&&z(h)?a=e.length/h:z(a)&&!y(h)&&(h=e.length/a),(!z(a)||!z(h))&&f(new u(v.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given")),c=a,d=h):1===b.length&&z(b[0])?(c=b[0],d=b[0],e=A(c*d,0)):
2===b.length&&z(b[0])&&z(b[1])?(c=b[0],d=b[1],e=A(c*d,0)):f(new u(v.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",w);w.prototype=Object.create(r.prototype);var B={stringify:{O:"\r\n",z:"\t"},i:{mode:"both"},j:{C:0},n:{which:"max"},random:{K:0,J:1,L:k}};r.options=B;r.prototype.get=function(a,b){C(this,a,b)||f(new u(v.OUT_OF_BOUNDS));return this.b(a,b)};r.prototype.get=r.prototype.get;
r.prototype.set=function(a,b,c){C(this,a,b)||f(new u(v.OUT_OF_BOUNDS));y(c)||f(new u(v.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};r.prototype.set=r.prototype.set;r.prototype.H=function(a,b){b=D(b,m);C(this,a,l)||f(new u(v.OUT_OF_BOUNDS));return E(this,a,b)};r.prototype.getRow=r.prototype.H;function E(a,b,c){for(var d=[],e=a.a().c,g=1;g<=e;g++)d.push(a.b(b,g));return c?new w(d,1):d}
r.prototype.Q=function(a,b){b=F(b);C(this,a,l)||f(new u(v.OUT_OF_BOUNDS));b.length!==this.a().c&&f(new u(v.INVALID_PARAMETERS,"Wrong number of columns in row."));return G(this,a,b)};r.prototype.setRow=r.prototype.Q;function G(a,b,c){for(var d=a.a().c,e=1;e<=d;e++)a.d(b,e,c[e-1]);return a}r.prototype.G=function(a,b){b=D(b,m);C(this,l,a)||f(new u(v.OUT_OF_BOUNDS));return H(this,a,b)};r.prototype.getColumn=r.prototype.G;
function H(a,b,c){for(var d=[],e=a.a().rows,g=1;g<=e;g++)d.push(a.b(g,b));return c?new w(d,l,1):d}r.prototype.P=function(a,b){b=F(b);C(this,l,a)||f(new u(v.OUT_OF_BOUNDS));b.length!==this.a().rows&&f(new u(v.INVALID_PARAMETERS,"Wrong number of rows in column"));return I(this,a,b)};r.prototype.setColumn=r.prototype.P;function I(a,b,c){for(var d=a.a().rows,e=1;e<=d;e++)a.d(e,b,c[e-1]);return a}r.prototype.f=function(){return 1===this.m("min")};r.prototype.isVector=r.prototype.f;
r.prototype.e=function(){return this.a().rows===this.a().c};r.prototype.isSquare=r.prototype.e;r.prototype.I=function(){this.e()||f(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.b(b,c)!==this.b(c,b))return m;return k};r.prototype.isSymmetric=r.prototype.I;
r.prototype.i=function(a){a=J(a,B.i.mode);this.e()||f(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return K(this,m);case "upper":return K(this,k);case "both":return K(this,k)||K(this,m);default:f(new u(v.INVALID_PARAMETERS,"Mode not supported"))}};r.prototype.isTriangular=r.prototype.i;function K(a,b){for(var c=b?1:-1,d,e,g=a.a().rows,h=1;h<g;h++){d=a.diag(c*h);e=d.length;for(var n=0;n<e;n++)if(0!==d[n])return m}return k}
r.prototype.copy=function(){for(var a=this.a().rows,b=this.a().c,b=new w(a,b),c=1;c<=a;c++)G(b,c,E(this,c,m));return b};r.prototype.copy=r.prototype.copy;r.prototype.size=function(){return this.a().rows*this.a().c};r.prototype.size=r.prototype.size;r.prototype.m=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.c;case "max":return Math.max(b.rows,b.c);case "min":return Math.min(b.rows,b.c);default:f(new u(v.INVALID_PARAMETERS,"Parameter must match a known value"))}};
r.prototype.dim=r.prototype.m;r.prototype.add=function(a){var b=this.a().rows,c=this.a().c;if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(Object(this.add(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().c)&&f(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=new w(b,c),e=1;e<=b;e++)for(var g=1;g<=c;g++)d.d(e,g,this.b(e,g)+a.b(e,g));return d};r.prototype.add=r.prototype.add;
r.prototype.o=function(a){var b=this.a().rows,c=this.a().c;if(1<arguments.length)return b=[].slice.call(arguments),this.o.apply(Object(this.o(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().c)&&f(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=new w(b,c),e=1;e<=b;e++)for(var g=1;g<=c;g++)d.d(e,g,this.b(e,g)-a.b(e,g));return d};r.prototype.subtract=r.prototype.o;
r.prototype.scale=function(a){y(a)||f(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().c,d=new w(b,c),e=1;e<=b;e++)for(var g=1;g<=c;g++)d.d(e,g,a*this.b(e,g));return d};r.prototype.scale=r.prototype.scale;
r.prototype.multiply=function(a){var b=this.a().rows,c=this.a().c,d=a.a().c;c!==a.a().rows&&f(new u(v.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var e=new w(b,d),g=1;g<=b;g++)for(var h=1;h<=d;h++){for(var n=0,s=1;s<=c;s++)n+=this.b(g,s)*a.b(s,h);e.d(g,h,n)}return e};r.prototype.multiply=r.prototype.multiply;r.prototype.u=function(){for(var a=this.a().rows,b=this.a().c,b=new w(b,a),c=1;c<=a;c++)I(b,c,E(this,c,m));return b};r.prototype.transpose=r.prototype.u;
r.prototype.trace=function(){this.e()||f(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=this.b(c,c);return b};r.prototype.trace=r.prototype.trace;
r.prototype.l=function(){var a=0,b=this.copy(),c,d,e,g=this.a().rows,h=this.a().c,n,s;for(e=1;e<=g;e++){d=0;n=-1;for(c=e;c<=g;c++)s=Math.abs(b.b(c,e)),s>=n&&(d=c,n=s);0===b.b(d,e)&&f(new u(v.MATRIX_IS_SINGULAR));d!==e&&(c=E(b,d,m),G(b,d,E(b,e,m)),G(b,e,c),a++);for(c=e+1;c<=g;c++){for(d=e+1;d<=h;d++)b.d(c,d,b.b(c,d)-b.b(e,d)*(b.b(c,e)/b.b(e,e)));b.d(c,e,0)}}b.S=a;return b};r.prototype.decomposeLU=r.prototype.l;
r.prototype.B=function(){var a,b,c=this.a().rows;this.e()||f(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));if(this.i())for(a=b=1;a<=this.a().rows;a++)b*=this.b(a,a);else{try{var d=this.l()}catch(e){if(e.code&&e.code===v.MATRIX_IS_SINGULAR)return 0;f(e)}b=Math.pow(-1,d.S);for(a=1;a<=c;a++)b*=d.b(a,a)}return b};r.prototype.det=r.prototype.B;
r.prototype.inverse=function(){this.e()||f(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.k(L(this.a().rows)),b,c,d,e,g,h,n;try{a=a.l();h=a.a().rows;n=a.a().c;for(c=h;1<c;c--){b=E(a,c,m);g=a.b(c-1,c)/a.b(c,c);for(e=0;e<n;e++)a.d(c-1,e+1,a.b(c-1,e+1)-b[e]*g)}for(d=1;d<=h;d++){b=E(a,d,m);for(e=0;e<n;e++)b[e]/=a.b(d,d);G(a,d,b)}}catch(s){f(new u(v.MATRIX_IS_SINGULAR))}return a.t(1,a.a().rows,this.a().c+1,a.a().c)};r.prototype.inverse=r.prototype.inverse;
r.prototype.t=function(a,b,c,d){(!C(this,a,c)||!C(this,b,d)||a>b||c>d)&&f(new u(v.OUT_OF_BOUNDS));for(var e=new w(b-a+1,d-c+1),g=a;g<=b;g++)G(e,g-a+1,E(this,g,m).slice(c-1,d));return e};r.prototype.submatrix=r.prototype.t;r.prototype.k=function(a){var b=this.a().c,c=a.a().c;this.a().rows!==a.a().rows&&f(new u(v.INVALID_PARAMETERS,"Number of rows must match"));for(var d=new w(this.a().rows,b+c),e=1;e<=b;e++)I(d,e,H(this,e,m));for(b=1;b<=c;b++)I(d,b+this.a().c,H(a,b,m));return d};
r.prototype.augment=r.prototype.k;r.prototype.D=function(a){var b=this.a().rows;(!this.f()||!a.f()||1!==this.a().c||1!==a.a().c)&&f(new u(v.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&f(new u(v.DIMENSION_MISMATCH));for(var c=0,d=1;d<=b;d++)c+=this.b(d,1)*a.b(d,1);return c};r.prototype.dot=r.prototype.D;r.prototype.round=function(){return this.j(0)};r.prototype.round=r.prototype.round;
r.prototype.j=function(a){a=y(a)?a:B.j.C;var b=this.copy();a=Math.pow(10,a);for(var c=b.a().rows,d=b.a().c,e=1;e<=c;e++)for(var g=1;g<=d;g++)b.d(e,g,Math.round(b.b(e,g)*a)/a);return b};r.prototype.roundTo=r.prototype.j;r.prototype.abs=function(){for(var a=this.copy(),b=a.a().rows,c=a.a().c,d=1;d<=b;d++)for(var e=1;e<=c;e++)a.d(d,e,Math.abs(a.b(d,e)));return a};r.prototype.abs=r.prototype.abs;
r.prototype.A=function(a){(!this.f()||!a.f()||3!==this.a().rows||3!==a.a().rows)&&f(new u(v.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return new w([[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};r.prototype.cross=r.prototype.A;r.prototype.w=function(a){a=F(a);for(var b=this.a().rows,c=new w(b+1,this.a().c),d=1;d<=b;d++)G(c,d,E(this,d,m));G(c,b+1,a);return c};
r.prototype.addRow=r.prototype.w;r.prototype.v=function(a){return this.copy().k(new w(F(a),l,1))};r.prototype.addColumn=r.prototype.v;r.prototype.contains=function(a,b){b=y(b)?b:0;var c=this.a().rows,d=this.a().c;(!y(a)||!y(b))&&f(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var e=1;e<=c;e++)for(var g=1;g<=d;g++)if(0===b){if(this.b(e,g)===a)return k}else if(Math.abs(this.b(e,g)-a)<=b)return k;return m};r.prototype.contains=r.prototype.contains;
r.prototype.stringify=function(a,b){a=J(a,B.stringify.O);b=J(b,B.stringify.z);for(var c=[],d,e=this.a().rows,g=this.a().c,h=1;h<=e;h++){d=[];for(var n=1;n<=g;n++)d.push(this.b(h,n));c.push(d.join(b))}return c.join(a)};r.prototype.stringify=r.prototype.stringify;r.prototype.F=function(a){var b=this.a().rows,c=this.a().c;if(b!==a.a().rows||c!==a.a().c)return m;for(var d=1;d<=b;d++)for(var e=1;e<=c;e++)if(this.b(d,e)!==a.b(d,e))return m;return k};r.prototype.equals=r.prototype.F;
r.prototype.h=function(a,b){b=b||M.all;"function"!==typeof a&&f(new u(v.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&f(new u(v.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),d,e=c.a().rows,g=c.a().c,h=1;h<=e;h++)for(var n=1;n<=g;n++)d=c.b(h,n),b(d,h,n)&&c.d(h,n,a(d,h,n));return c};r.prototype.fun=r.prototype.h;r.prototype.R=function(a){return this.h(a,M.nonZero)};r.prototype.spfun=r.prototype.R;r.prototype.M=function(){return this.h(N.exp,l)};
r.prototype.pw_exp=r.prototype.M;r.prototype.N=function(a){return this.h(function(b){return Math.pow(b,a)},l)};r.prototype.pw_pow=r.prototype.N;r.prototype.n=function(a,b){a=J(a,B.n.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.g(Number(b));case "frobenius":return this.g(2);case "rows":case "rowsum":return this.s();case "columns":case "columnsum":return this.q();case "max":return this.r();default:f(new u(v.INVALID_PARAMETERS,"Norm not supported"))}};r.prototype.norm=r.prototype.n;
r.prototype.g=function(a){z(a)||f(new u(v.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,d=this.a().c,e=1;e<=c;e++)for(var g=1;g<=d;g++)b+=Math.pow(Math.abs(this.b(e,g)),a);return Math.pow(b,1/a)};r.prototype.pnorm=r.prototype.g;r.prototype.r=function(){for(var a=0,b=this.a().rows,c=this.a().c,d=1;d<=b;d++)for(var e=1;e<=c;e++)a=Math.max(a,Math.abs(this.b(d,e)));return a};r.prototype.maxnorm=r.prototype.r;
r.prototype.s=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,E(this,c,k).g(1));return a};r.prototype.rownorm=r.prototype.s;r.prototype.q=function(){for(var a=0,b=this.a().c,c=1;c<=b;c++)a=Math.max(a,H(this,c,k).g(1));return a};r.prototype.columnnorm=r.prototype.q;r.prototype.diag=function(a){a=y(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var d=0===c?this.a().c-a:this.a().rows-c;0>=d&&f(new u(v.OUT_OF_BOUNDS));for(var e=1;e<=d;e++)b.push(this.b(e+c,e+a));return b};
r.prototype.diag=r.prototype.diag;Array.prototype.p=function(a,b){return new w(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.p);Array.prototype.T=function(a){a=D(a,m);return new w(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.T);
String.prototype.p=function(a,b){a=J(a,"\r\n");b=J(b,"\t");for(var c=this.split(a),d,e=0,g=new w(0),h=0;h<c.length;h++){d=c[h].split(b);0===e&&(e=d.length,g=new w(c.length,e));d.length!==e&&f(new u(v.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var n=1;n<=e;n++)g.d(h+1,n,Number(d[n-1]))}return g};q("String.prototype.toMatrix",String.prototype.p);function C(a,b,c){return(!y(b)||1<=b&&b<=a.a().rows)&&(!y(c)||1<=c&&c<=a.a().c)}function y(a){return"number"===typeof a}
function z(a){return y(a)&&(a|0)===a}function x(a){for(var b=0;b<a.length;b++)if(!y(a[b]))return m;return k}function F(a){if(!(a instanceof w))return a;a.f()||f(new u(v.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.m("max")!==a.a().rows&&(b=b.u());a=[];for(var c=b.a().rows,d=1;d<=c;d++)a.push(b.b(d,1));return a}function J(a,b){return"string"===typeof a?a:b}function D(a,b){return"boolean"===typeof a?a:b}
var M={all:function(){return k},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};t.filters=M;var N={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};t.applicators=N;w.zeros=function(a,b){b=y(b)?b:a;return new w(a,b)};w.ones=function(a,b){b=y(b)?b:a;for(var c=new w(a,b),d=1;d<=a;d++)for(var e=1;e<=b;e++)c.d(d,e,1);return c};function L(a){for(var b=new w(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}w.eye=L;
w.diag=function(a,b){a=F(a);b=y(b)?b:0;for(var c=new w(a.length+Math.abs(b)),d=-Math.min(b,0),e=Math.max(b,0),g=c.a().rows-Math.abs(b),h=1;h<=g;h++)c.d(h+d,h+e,a[h-1]);return c};w.diag=w.diag;w.random=function(a,b,c,d,e){b=y(b)?b:a;c=y(c)?c:B.random.K;d=y(d)?d:B.random.J;e=D(e,B.random.L);var g=new w(a,b);d=d-c+(e?1:0);for(var h,n=1;n<=a;n++)for(var s=1;s<=b;s++)h=c+Math.random()*d,e&&(h|=0),g.d(n,s,h);return g};w.linspace=function(a,b,c){c=y(c)?c:1;for(var d=[];a<=b;a+=c)d.push(a);return d};
function A(a,b){for(var c=[],d=1;d<=a;d++)c[d-1]=b;return c}w.repeat=A;
