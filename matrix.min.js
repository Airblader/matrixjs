function d(a){throw a;}var k=!0,l=null,m=!1,p=this;Math.random();function q(a,b){var c=a.split("."),e=p;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function s(a){var b=[].slice.call(arguments),c,e,f=[];this.b=function(a,b){return f[e*(a-1)+b-1]};this.d=function(a,b,c){f[e*(a-1)+b-1]=c;return this};this.a=function(){return{rows:c,c:e}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;e=-1;for(var a=0;a<b[0].length;a++){b[0][a].length!==e&&-1!==e&&d(new t(u.INVALID_PARAMETERS,"Number of columns must be the same for all rows"));v(b[0][a])||d(new t(u.INVALID_PARAMETERS,"Elements must be numbers"));
e=Math.max(e,b[0][a].length);for(var h=0;h<b[0][a].length;h++)f.push(b[0][a][h])}}else 1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||w(b[0][0]))?(v(b[0])||d(new t(u.INVALID_PARAMETERS,"Elements must be numbers")),f=b[0],a=b[1],h=b[2],!w(a)&&!w(h)?a=h=Math.sqrt(f.length):!w(a)&&x(h)?a=f.length/h:x(a)&&!w(h)&&(h=f.length/a),(!x(a)||!x(h))&&d(new t(u.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given")),c=a,e=h):1===b.length&&x(b[0])?(c=b[0],e=b[0],f=y(c*e,0)):
2===b.length&&x(b[0])&&x(b[1])?(c=b[0],e=b[1],f=y(c*e,0)):d(new t(u.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",s);var z={stringify:{O:"\r\n",z:"\t"},i:{mode:"both"},j:{C:0},n:{which:"max"},random:{K:0,J:1,L:k}};s.options=z;s.prototype.get=function(a,b){A(this,a,b)||d(new t(u.OUT_OF_BOUNDS));return this.b(a,b)};s.prototype.get=s.prototype.get;
s.prototype.set=function(a,b,c){A(this,a,b)||d(new t(u.OUT_OF_BOUNDS));w(c)||d(new t(u.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};s.prototype.set=s.prototype.set;s.prototype.H=function(a,b){b=B(b,m);A(this,a,l)||d(new t(u.OUT_OF_BOUNDS));return C(this,a,b)};s.prototype.getRow=s.prototype.H;function C(a,b,c){for(var e=[],f=a.a().c,g=1;g<=f;g++)e.push(a.b(b,g));return c?new s(e,1):e}
s.prototype.Q=function(a,b){b=D(b);A(this,a,l)||d(new t(u.OUT_OF_BOUNDS));b.length!==this.a().c&&d(new t(u.INVALID_PARAMETERS,"Wrong number of columns in row."));return E(this,a,b)};s.prototype.setRow=s.prototype.Q;function E(a,b,c){for(var e=a.a().c,f=1;f<=e;f++)a.d(b,f,c[f-1]);return a}s.prototype.G=function(a,b){b=B(b,m);A(this,l,a)||d(new t(u.OUT_OF_BOUNDS));return F(this,a,b)};s.prototype.getColumn=s.prototype.G;
function F(a,b,c){for(var e=[],f=a.a().rows,g=1;g<=f;g++)e.push(a.b(g,b));return c?new s(e,l,1):e}s.prototype.P=function(a,b){b=D(b);A(this,l,a)||d(new t(u.OUT_OF_BOUNDS));b.length!==this.a().rows&&d(new t(u.INVALID_PARAMETERS,"Wrong number of rows in column"));return G(this,a,b)};s.prototype.setColumn=s.prototype.P;function G(a,b,c){for(var e=a.a().rows,f=1;f<=e;f++)a.d(f,b,c[f-1]);return a}s.prototype.f=function(){return 1===this.m("min")};s.prototype.isVector=s.prototype.f;
s.prototype.e=function(){return this.a().rows===this.a().c};s.prototype.isSquare=s.prototype.e;s.prototype.I=function(){this.e()||d(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.b(b,c)!==this.b(c,b))return m;return k};s.prototype.isSymmetric=s.prototype.I;
s.prototype.i=function(a){a=H(a,z.i.mode);this.e()||d(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return I(this,m);case "upper":return I(this,k);case "both":return I(this,k)||I(this,m);default:d(new t(u.INVALID_PARAMETERS,"Mode not supported"))}};s.prototype.isTriangular=s.prototype.i;function I(a,b){for(var c=b?1:-1,e,f,g=a.a().rows,h=1;h<g;h++){e=a.diag(c*h);f=e.length;for(var n=0;n<f;n++)if(0!==e[n])return m}return k}
s.prototype.copy=function(){for(var a=this.a().rows,b=new s(a,this.a().c),c=1;c<=a;c++)E(b,c,C(this,c,m));return b};s.prototype.copy=s.prototype.copy;s.prototype.size=function(){return this.a().rows*this.a().c};s.prototype.size=s.prototype.size;s.prototype.m=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.c;case "max":return Math.max(b.rows,b.c);case "min":return Math.min(b.rows,b.c);default:d(new t(u.INVALID_PARAMETERS,"Parameter must match a known value"))}};
s.prototype.dim=s.prototype.m;s.prototype.add=function(a){var b=this.a().rows,c=this.a().c;if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(Object(this.add(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().c)&&d(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new s(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)e.d(f,g,this.b(f,g)+a.b(f,g));return e};s.prototype.add=s.prototype.add;
s.prototype.o=function(a){var b=this.a().rows,c=this.a().c;if(1<arguments.length)return b=[].slice.call(arguments),this.o.apply(Object(this.o(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().c)&&d(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new s(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)e.d(f,g,this.b(f,g)-a.b(f,g));return e};s.prototype.subtract=s.prototype.o;
s.prototype.scale=function(a){w(a)||d(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().c,e=new s(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)e.d(f,g,a*this.b(f,g));return e};s.prototype.scale=s.prototype.scale;
s.prototype.multiply=function(a){var b=this.a().rows,c=this.a().c,e=a.a().c;c!==a.a().rows&&d(new t(u.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=new s(b,e),g=1;g<=b;g++)for(var h=1;h<=e;h++){for(var n=0,r=1;r<=c;r++)n+=this.b(g,r)*a.b(r,h);f.d(g,h,n)}return f};s.prototype.multiply=s.prototype.multiply;s.prototype.u=function(){for(var a=this.a().rows,b=new s(this.a().c,a),c=1;c<=a;c++)G(b,c,C(this,c,m));return b};s.prototype.transpose=s.prototype.u;
s.prototype.trace=function(){this.e()||d(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=this.b(c,c);return b};s.prototype.trace=s.prototype.trace;
s.prototype.l=function(){var a=0,b=this.copy(),c,e,f,g=this.a().rows,h=this.a().c,n,r;for(f=1;f<=g;f++){e=0;n=-1;for(c=f;c<=g;c++)r=Math.abs(b.b(c,f)),r>=n&&(e=c,n=r);0===b.b(e,f)&&d(new t(u.MATRIX_IS_SINGULAR));e!==f&&(c=C(b,e,m),E(b,e,C(b,f,m)),E(b,f,c),a++);for(c=f+1;c<=g;c++){for(e=f+1;e<=h;e++)b.d(c,e,b.b(c,e)-b.b(f,e)*(b.b(c,f)/b.b(f,f)));b.d(c,f,0)}}b.S=a;return b};s.prototype.decomposeLU=s.prototype.l;
s.prototype.B=function(){var a,b,c=this.a().rows;this.e()||d(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));if(this.i())for(a=b=1;a<=this.a().rows;a++)b*=this.b(a,a);else{try{var e=this.l()}catch(f){if(f.code&&f.code===u.MATRIX_IS_SINGULAR)return 0;d(f)}b=Math.pow(-1,e.S);for(a=1;a<=c;a++)b*=e.b(a,a)}return b};s.prototype.det=s.prototype.B;
s.prototype.inverse=function(){this.e()||d(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.k(J(this.a().rows)),b,c,e,f,g,h,n;try{a=a.l();h=a.a().rows;n=a.a().c;for(c=h;1<c;c--){b=C(a,c,m);g=a.b(c-1,c)/a.b(c,c);for(f=0;f<n;f++)a.d(c-1,f+1,a.b(c-1,f+1)-b[f]*g)}for(e=1;e<=h;e++){b=C(a,e,m);for(f=0;f<n;f++)b[f]/=a.b(e,e);E(a,e,b)}}catch(r){d(new t(u.MATRIX_IS_SINGULAR))}return a.t(1,a.a().rows,this.a().c+1,a.a().c)};s.prototype.inverse=s.prototype.inverse;
s.prototype.t=function(a,b,c,e){(!A(this,a,c)||!A(this,b,e)||a>b||c>e)&&d(new t(u.OUT_OF_BOUNDS));for(var f=new s(b-a+1,e-c+1),g=a;g<=b;g++)E(f,g-a+1,C(this,g,m).slice(c-1,e));return f};s.prototype.submatrix=s.prototype.t;s.prototype.k=function(a){var b=this.a().c,c=a.a().c;this.a().rows!==a.a().rows&&d(new t(u.INVALID_PARAMETERS,"Number of rows must match"));for(var e=new s(this.a().rows,b+c),f=1;f<=b;f++)G(e,f,F(this,f,m));for(b=1;b<=c;b++)G(e,b+this.a().c,F(a,b,m));return e};
s.prototype.augment=s.prototype.k;s.prototype.D=function(a){var b=this.a().rows;(!this.f()||!a.f()||1!==this.a().c||1!==a.a().c)&&d(new t(u.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&d(new t(u.DIMENSION_MISMATCH));for(var c=0,e=1;e<=b;e++)c+=this.b(e,1)*a.b(e,1);return c};s.prototype.dot=s.prototype.D;s.prototype.round=function(){return this.j(0)};s.prototype.round=s.prototype.round;
s.prototype.j=function(a){a=w(a)?a:z.j.C;var b=this.copy();a=Math.pow(10,a);for(var c=b.a().rows,e=b.a().c,f=1;f<=c;f++)for(var g=1;g<=e;g++)b.d(f,g,Math.round(b.b(f,g)*a)/a);return b};s.prototype.roundTo=s.prototype.j;s.prototype.abs=function(){for(var a=this.copy(),b=a.a().rows,c=a.a().c,e=1;e<=b;e++)for(var f=1;f<=c;f++)a.d(e,f,Math.abs(a.b(e,f)));return a};s.prototype.abs=s.prototype.abs;
s.prototype.A=function(a){(!this.f()||!a.f()||3!==this.a().rows||3!==a.a().rows)&&d(new t(u.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return new s([[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};s.prototype.cross=s.prototype.A;s.prototype.w=function(a){a=D(a);for(var b=this.a().rows,c=new s(b+1,this.a().c),e=1;e<=b;e++)E(c,e,C(this,e,m));E(c,b+1,a);return c};
s.prototype.addRow=s.prototype.w;s.prototype.v=function(a){return this.copy().k(new s(D(a),l,1))};s.prototype.addColumn=s.prototype.v;s.prototype.contains=function(a,b){b=w(b)?b:0;var c=this.a().rows,e=this.a().c;(!w(a)||!w(b))&&d(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var f=1;f<=c;f++)for(var g=1;g<=e;g++)if(0===b){if(this.b(f,g)===a)return k}else if(Math.abs(this.b(f,g)-a)<=b)return k;return m};s.prototype.contains=s.prototype.contains;
s.prototype.stringify=function(a,b){a=H(a,z.stringify.O);b=H(b,z.stringify.z);for(var c=[],e,f=this.a().rows,g=this.a().c,h=1;h<=f;h++){e=[];for(var n=1;n<=g;n++)e.push(this.b(h,n));c.push(e.join(b))}return c.join(a)};s.prototype.stringify=s.prototype.stringify;s.prototype.F=function(a){var b=this.a().rows,c=this.a().c;if(b!==a.a().rows||c!==a.a().c)return m;for(var e=1;e<=b;e++)for(var f=1;f<=c;f++)if(this.b(e,f)!==a.b(e,f))return m;return k};s.prototype.equals=s.prototype.F;
s.prototype.h=function(a,b){b=b||K.all;"function"!==typeof a&&d(new t(u.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&d(new t(u.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),e,f=c.a().rows,g=c.a().c,h=1;h<=f;h++)for(var n=1;n<=g;n++)e=c.b(h,n),b(e,h,n)&&c.d(h,n,a(e,h,n));return c};s.prototype.fun=s.prototype.h;s.prototype.R=function(a){return this.h(a,K.nonZero)};s.prototype.spfun=s.prototype.R;s.prototype.M=function(){return this.h(L.exp,l)};
s.prototype.pw_exp=s.prototype.M;s.prototype.N=function(a){return this.h(function(b){return Math.pow(b,a)},l)};s.prototype.pw_pow=s.prototype.N;s.prototype.n=function(a,b){a=H(a,z.n.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.g(Number(b));case "frobenius":return this.g(2);case "rows":case "rowsum":return this.s();case "columns":case "columnsum":return this.q();case "max":return this.r();default:d(new t(u.INVALID_PARAMETERS,"Norm not supported"))}};s.prototype.norm=s.prototype.n;
s.prototype.g=function(a){x(a)||d(new t(u.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,e=this.a().c,f=1;f<=c;f++)for(var g=1;g<=e;g++)b+=Math.pow(Math.abs(this.b(f,g)),a);return Math.pow(b,1/a)};s.prototype.pnorm=s.prototype.g;s.prototype.r=function(){for(var a=0,b=this.a().rows,c=this.a().c,e=1;e<=b;e++)for(var f=1;f<=c;f++)a=Math.max(a,Math.abs(this.b(e,f)));return a};s.prototype.maxnorm=s.prototype.r;
s.prototype.s=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,C(this,c,k).g(1));return a};s.prototype.rownorm=s.prototype.s;s.prototype.q=function(){for(var a=0,b=this.a().c,c=1;c<=b;c++)a=Math.max(a,F(this,c,k).g(1));return a};s.prototype.columnnorm=s.prototype.q;s.prototype.diag=function(a){a=w(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var e=0===c?this.a().c-a:this.a().rows-c;0>=e&&d(new t(u.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(this.b(f+c,f+a));return b};
s.prototype.diag=s.prototype.diag;Array.prototype.p=function(a,b){return new s(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.p);Array.prototype.T=function(a){a=B(a,m);return new s(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.T);
String.prototype.p=function(a,b){a=H(a,"\r\n");b=H(b,"\t");for(var c=this.split(a),e,f=0,g=new s(0),h=0;h<c.length;h++){e=c[h].split(b);0===f&&(f=e.length,g=new s(c.length,f));e.length!==f&&d(new t(u.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var n=1;n<=f;n++)g.d(h+1,n,Number(e[n-1]))}return g};q("String.prototype.toMatrix",String.prototype.p);function A(a,b,c){return(!w(b)||1<=b&&b<=a.a().rows)&&(!w(c)||1<=c&&c<=a.a().c)}function w(a){return"number"===typeof a}
function x(a){return w(a)&&(a|0)===a}function v(a){for(var b=0;b<a.length;b++)if(!w(a[b]))return m;return k}function D(a){if(!(a instanceof s))return a;a.f()||d(new t(u.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.m("max")!==a.a().rows&&(b=b.u());a=[];for(var c=b.a().rows,e=1;e<=c;e++)a.push(b.b(e,1));return a}function H(a,b){return"string"===typeof a?a:b}function B(a,b){return"boolean"===typeof a?a:b}
function t(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}s.MatrixError=t;var u={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular"};s.ErrorCodes=u;var K={all:function(){return k},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};s.filters=K;
var L={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};s.applicators=L;s.zeros=function(a,b){b=w(b)?b:a;return new s(a,b)};s.ones=function(a,b){b=w(b)?b:a;for(var c=new s(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)c.d(e,f,1);return c};function J(a){for(var b=new s(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}s.eye=J;s.diag=function(a,b){a=D(a);b=w(b)?b:0;for(var c=new s(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),g=c.a().rows-Math.abs(b),h=1;h<=g;h++)c.d(h+e,h+f,a[h-1]);return c};
s.diag=s.diag;s.random=function(a,b,c,e,f){b=w(b)?b:a;c=w(c)?c:z.random.K;e=w(e)?e:z.random.J;f=B(f,z.random.L);var g=new s(a,b);e=e-c+(f?1:0);for(var h,n=1;n<=a;n++)for(var r=1;r<=b;r++)h=c+Math.random()*e,f&&(h|=0),g.d(n,r,h);return g};s.linspace=function(a,b,c){c=w(c)?c:1;for(var e=[];a<=b;a+=c)e.push(a);return e};function y(a,b){for(var c=[],e=1;e<=a;e++)c[e-1]=b;return c}s.repeat=y;
