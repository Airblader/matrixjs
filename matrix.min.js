function e(a){throw a;}var k=!0,l=null,m=!1,p=this;Math.random();function q(a,b){var c=a.split("."),d=p;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?d[f]=b:d=d[f]?d[f]:d[f]={}};function r(){this.constructor=l;this.b=function(){return l};this.d=function(){return this};this.a=function(){return{rows:l,c:l}};e(Error("MatrixCommon cannot be instantiated"))}q("MatrixCommon",r);function t(){e(Error("This cannot be instantiated"))}q("MatrixUtils",t);function u(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q("MatrixError",u);
var v={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};u.ErrorCodes=v;
function w(a){var b=[].slice.call(arguments),c,d,f=[];this.b=function(b,a){return f[d*(b-1)+a-1]};this.d=function(b,a,c){f[d*(b-1)+a-1]=c;return this};this.a=function(){return{rows:c,c:d}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;d=-1;for(var a=0;a<b[0].length;a++){b[0][a].length!==d&&-1!==d&&e(new u(v.INVALID_PARAMETERS,"Number of columns must be the same for all rows"));x(b[0][a])||e(new u(v.INVALID_PARAMETERS,"Elements must be numbers"));
d=Math.max(d,b[0][a].length);for(var h=0;h<b[0][a].length;h++)f.push(b[0][a][h])}}else 1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||y(b[0][0]))?(x(b[0])||e(new u(v.INVALID_PARAMETERS,"Elements must be numbers")),f=b[0],a=b[1],h=b[2],!y(a)&&!y(h)?a=h=Math.sqrt(f.length):!y(a)&&z(h)?a=f.length/h:z(a)&&!y(h)&&(h=f.length/a),(!z(a)||!z(h))&&e(new u(v.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given")),c=a,d=h):1===b.length&&z(b[0])?(c=b[0],d=b[0],f=A(c*d,0)):
2===b.length&&z(b[0])&&z(b[1])?(c=b[0],d=b[1],f=A(c*d,0)):e(new u(v.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",w);w.prototype=Object.create(r.prototype);w.prototype.constructor=w;function B(){e(Error("Not yet implemented."))}q("SparseMatrix",B);B.prototype=Object.create(r.prototype);B.prototype.constructor=B;
function C(a){[].slice.call(arguments);var b=[];this.b=function(a,d){return b[d-1]};this.d=function(a,d,f){b[d-1]=f;return this};this.a=function(){return{rows:1,c:b.length}};return this}q("Vector",C);C.prototype=Object.create(r.prototype);C.prototype.constructor=C;var D={stringify:{Q:"\r\n",B:"\t"},k:{mode:"both"},l:{F:0},p:{which:"max"},random:{M:0,L:1,N:k}};r.options=D;r.prototype.e=function(a){var b=this.constructor;return new (b.bind.apply(b,[b].concat([].slice.call(arguments))))};
r.prototype.get=function(a,b){this.f(a,b)||e(new u(v.OUT_OF_BOUNDS));return this.b(a,b)};r.prototype.get=r.prototype.get;r.prototype.set=function(a,b,c){this.f(a,b)||e(new u(v.OUT_OF_BOUNDS));y(c)||e(new u(v.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};r.prototype.set=r.prototype.set;r.prototype.J=function(a,b){b=E(b,m);this.f(a,l)||e(new u(v.OUT_OF_BOUNDS));return F(this,a,b)};r.prototype.getRow=r.prototype.J;
function F(a,b,c){for(var d=[],f=a.a().c,g=1;g<=f;g++)d.push(a.b(b,g));return c?a.e(d,1):d}r.prototype.S=function(a,b){b=G(b);this.f(a,l)||e(new u(v.OUT_OF_BOUNDS));b.length!==this.a().c&&e(new u(v.INVALID_PARAMETERS,"Wrong number of columns in row."));return H(this,a,b)};r.prototype.setRow=r.prototype.S;function H(a,b,c){for(var d=a.a().c,f=1;f<=d;f++)a.d(b,f,c[f-1]);return a}r.prototype.I=function(a,b){b=E(b,m);this.f(l,a)||e(new u(v.OUT_OF_BOUNDS));return I(this,a,b)};r.prototype.getColumn=r.prototype.I;
function I(a,b,c){for(var d=[],f=a.a().rows,g=1;g<=f;g++)d.push(a.b(g,b));return c?a.e(d,l,1):d}r.prototype.R=function(a,b){b=G(b);this.f(l,a)||e(new u(v.OUT_OF_BOUNDS));b.length!==this.a().rows&&e(new u(v.INVALID_PARAMETERS,"Wrong number of rows in column"));return J(this,a,b)};r.prototype.setColumn=r.prototype.R;function J(a,b,c){for(var d=a.a().rows,f=1;f<=d;f++)a.d(f,b,c[f-1]);return a}r.prototype.i=function(){return 1===this.o("min")};r.prototype.isVector=r.prototype.i;
r.prototype.h=function(){return this.a().rows===this.a().c};r.prototype.isSquare=r.prototype.h;r.prototype.K=function(){this.h()||e(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.b(b,c)!==this.b(c,b))return m;return k};r.prototype.isSymmetric=r.prototype.K;
r.prototype.k=function(a){a=K(a,D.k.mode);this.h()||e(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return L(this,m);case "upper":return L(this,k);case "both":return L(this,k)||L(this,m);default:e(new u(v.INVALID_PARAMETERS,"Mode not supported"))}};r.prototype.isTriangular=r.prototype.k;function L(a,b){for(var c=b?1:-1,d,f,g=a.a().rows,h=1;h<g;h++){d=a.diag(c*h);f=d.length;for(var n=0;n<f;n++)if(0!==d[n])return m}return k}
r.prototype.copy=function(){for(var a=this.a().rows,b=this.e(a,this.a().c),c=1;c<=a;c++)H(b,c,F(this,c,m));return b};r.prototype.copy=r.prototype.copy;r.prototype.size=function(){var a=this.a();return a.rows*a.c};r.prototype.size=r.prototype.size;r.prototype.o=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.c;case "max":return Math.max(b.rows,b.c);case "min":return Math.min(b.rows,b.c);default:e(new u(v.INVALID_PARAMETERS,"Parameter must match a known value"))}};
r.prototype.dim=r.prototype.o;r.prototype.add=function(a){var b=this.a(),c=b.rows,b=b.c;if(1<arguments.length)return c=[].slice.call(arguments),this.add.apply(Object(this.add(c.shift())),Object(c));(c!==a.a().rows||b!==a.a().c)&&e(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.e(c,b),f=1;f<=c;f++)for(var g=1;g<=b;g++)d.d(f,g,this.b(f,g)+a.b(f,g));return d};r.prototype.add=r.prototype.add;
r.prototype.q=function(a){var b=this.a().rows,c=this.a().c;if(1<arguments.length)return b=[].slice.call(arguments),this.q.apply(Object(this.q(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().c)&&e(new u(v.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.e(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)d.d(f,g,this.b(f,g)-a.b(f,g));return d};r.prototype.subtract=r.prototype.q;
r.prototype.scale=function(a){y(a)||e(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().c,d=this.e(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)d.d(f,g,a*this.b(f,g));return d};r.prototype.scale=r.prototype.scale;
r.prototype.multiply=function(a){var b=this.a(),c=b.rows,b=b.c,d=a.a().c;b!==a.a().rows&&e(new u(v.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=this.e(c,d),g=1;g<=c;g++)for(var h=1;h<=d;h++){for(var n=0,s=1;s<=b;s++)n+=this.b(g,s)*a.b(s,h);f.d(g,h,n)}return f};r.prototype.multiply=r.prototype.multiply;r.prototype.w=function(){for(var a=this.a().rows,b=this.e(this.a().c,a),c=1;c<=a;c++)J(b,c,F(this,c,m));return b};r.prototype.transpose=r.prototype.w;
r.prototype.trace=function(){this.h()||e(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=this.b(c,c);return b};r.prototype.trace=r.prototype.trace;
r.prototype.n=function(){var a=0,b=this.copy(),c,d,f,g=this.a().rows,h=this.a().c,n,s;for(f=1;f<=g;f++){d=0;n=-1;for(c=f;c<=g;c++)s=Math.abs(b.b(c,f)),s>=n&&(d=c,n=s);0===b.b(d,f)&&e(new u(v.MATRIX_IS_SINGULAR));d!==f&&(c=F(b,d,m),H(b,d,F(b,f,m)),H(b,f,c),a++);for(c=f+1;c<=g;c++){for(d=f+1;d<=h;d++)b.d(c,d,b.b(c,d)-b.b(f,d)*(b.b(c,f)/b.b(f,f)));b.d(c,f,0)}}b.U=a;return b};r.prototype.decomposeLU=r.prototype.n;
r.prototype.D=function(){var a,b,c=this.a().rows;this.h()||e(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));if(this.k())for(a=b=1;a<=this.a().rows;a++)b*=this.b(a,a);else{try{var d=this.n()}catch(f){if(f.code&&f.code===v.MATRIX_IS_SINGULAR)return 0;e(f)}b=Math.pow(-1,d.U);for(a=1;a<=c;a++)b*=d.b(a,a)}return b};r.prototype.det=r.prototype.D;
r.prototype.inverse=function(){this.h()||e(new u(v.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.m(M(this.a().rows)),b,c,d,f,g,h,n;try{a=a.n();h=a.a().rows;n=a.a().c;for(c=h;1<c;c--){b=F(a,c,m);g=a.b(c-1,c)/a.b(c,c);for(f=0;f<n;f++)a.d(c-1,f+1,a.b(c-1,f+1)-b[f]*g)}for(d=1;d<=h;d++){b=F(a,d,m);for(f=0;f<n;f++)b[f]/=a.b(d,d);H(a,d,b)}}catch(s){e(new u(v.MATRIX_IS_SINGULAR))}return a.v(1,a.a().rows,this.a().c+1,a.a().c)};r.prototype.inverse=r.prototype.inverse;
r.prototype.v=function(a,b,c,d){(!this.f(a,c)||!this.f(b,d)||a>b||c>d)&&e(new u(v.OUT_OF_BOUNDS));for(var f=this.e(b-a+1,d-c+1),g=a;g<=b;g++)H(f,g-a+1,F(this,g,m).slice(c-1,d));return f};r.prototype.submatrix=r.prototype.v;r.prototype.m=function(a){var b=this.a().c,c=a.a().c;this.a().rows!==a.a().rows&&e(new u(v.INVALID_PARAMETERS,"Number of rows must match"));for(var d=this.e(this.a().rows,b+c),f=1;f<=b;f++)J(d,f,I(this,f,m));for(b=1;b<=c;b++)J(d,b+this.a().c,I(a,b,m));return d};
r.prototype.augment=r.prototype.m;r.prototype.G=function(a){var b=this.a().rows;(!this.i()||!a.i()||1!==this.a().c||1!==a.a().c)&&e(new u(v.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&e(new u(v.DIMENSION_MISMATCH));for(var c=0,d=1;d<=b;d++)c+=this.b(d,1)*a.b(d,1);return c};r.prototype.dot=r.prototype.G;r.prototype.round=function(){return this.l(0)};r.prototype.round=r.prototype.round;
r.prototype.l=function(a){a=y(a)?a:D.l.F;var b=Math.pow(10,a);return this.g(function(a){return Math.round(a*b)/b})};r.prototype.roundTo=r.prototype.l;r.prototype.abs=function(){return this.g(function(a){return Math.abs(a)})};r.prototype.abs=r.prototype.abs;
r.prototype.C=function(a){(!this.i()||!a.i()||3!==this.a().rows||3!==a.a().rows)&&e(new u(v.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return this.e([[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};r.prototype.cross=r.prototype.C;r.prototype.A=function(a){a=G(a);for(var b=this.a().rows,c=this.e(b+1,this.a().c),d=1;d<=b;d++)H(c,d,F(this,d,m));H(c,b+1,a);return c};
r.prototype.addRow=r.prototype.A;r.prototype.z=function(a){return this.copy().m(this.e(G(a),l,1))};r.prototype.addColumn=r.prototype.z;r.prototype.contains=function(a,b){b=y(b)?b:0;var c=this.a().rows,d=this.a().c;(!y(a)||!y(b))&&e(new u(v.INVALID_PARAMETERS,"Parameter must be a number"));for(var f=1;f<=c;f++)for(var g=1;g<=d;g++)if(0===b){if(this.b(f,g)===a)return k}else if(Math.abs(this.b(f,g)-a)<=b)return k;return m};r.prototype.contains=r.prototype.contains;
r.prototype.stringify=function(a,b){a=K(a,D.stringify.Q);b=K(b,D.stringify.B);for(var c=[],d,f=this.a().rows,g=this.a().c,h=1;h<=f;h++){d=[];for(var n=1;n<=g;n++)d.push(this.b(h,n));c.push(d.join(b))}return c.join(a)};r.prototype.stringify=r.prototype.stringify;r.prototype.H=function(a){var b=this.a().rows,c=this.a().c;if(b!==a.a().rows||c!==a.a().c)return m;for(var d=1;d<=b;d++)for(var f=1;f<=c;f++)if(this.b(d,f)!==a.b(d,f))return m;return k};r.prototype.equals=r.prototype.H;
r.prototype.g=function(a,b){b=b||N.all;"function"!==typeof a&&e(new u(v.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&e(new u(v.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),d,f=c.a().rows,g=c.a().c,h=1;h<=f;h++)for(var n=1;n<=g;n++)d=c.b(h,n),b(d,h,n)&&c.d(h,n,a(d,h,n));return c};r.prototype.fun=r.prototype.g;r.prototype.T=function(a){return this.g(a,N.nonZero)};r.prototype.spfun=r.prototype.T;r.prototype.O=function(){return this.g(O.exp,l)};
r.prototype.pw_exp=r.prototype.O;r.prototype.P=function(a){return this.g(function(b){return Math.pow(b,a)},l)};r.prototype.pw_pow=r.prototype.P;r.prototype.p=function(a,b){a=K(a,D.p.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.j(Number(b));case "frobenius":return this.j(2);case "rows":case "rowsum":return this.u();case "columns":case "columnsum":return this.s();case "max":return this.t();default:e(new u(v.INVALID_PARAMETERS,"Norm not supported"))}};r.prototype.norm=r.prototype.p;
r.prototype.j=function(a){z(a)||e(new u(v.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,d=this.a().c,f=1;f<=c;f++)for(var g=1;g<=d;g++)b+=Math.pow(Math.abs(this.b(f,g)),a);return Math.pow(b,1/a)};r.prototype.pnorm=r.prototype.j;r.prototype.t=function(){for(var a=0,b=this.a().rows,c=this.a().c,d=1;d<=b;d++)for(var f=1;f<=c;f++)a=Math.max(a,Math.abs(this.b(d,f)));return a};r.prototype.maxnorm=r.prototype.t;
r.prototype.u=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,F(this,c,k).j(1));return a};r.prototype.rownorm=r.prototype.u;r.prototype.s=function(){for(var a=0,b=this.a().c,c=1;c<=b;c++)a=Math.max(a,I(this,c,k).j(1));return a};r.prototype.columnnorm=r.prototype.s;r.prototype.diag=function(a){a=y(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var d=0===c?this.a().c-a:this.a().rows-c;0>=d&&e(new u(v.OUT_OF_BOUNDS));for(var f=1;f<=d;f++)b.push(this.b(f+c,f+a));return b};
r.prototype.diag=r.prototype.diag;r.prototype.f=function(a,b){return(!y(a)||1<=a&&a<=this.a().rows)&&(!y(b)||1<=b&&b<=this.a().c)};r.prototype.isInRange=r.prototype.f;w.zeros=function(a,b){b=y(b)?b:a;return new w(a,b)};w.ones=function(a,b){b=y(b)?b:a;for(var c=new w(a,b),d=1;d<=a;d++)for(var f=1;f<=b;f++)c.d(d,f,1);return c};function M(a){for(var b=new w(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}w.eye=M;
w.diag=function(a,b){a=G(a);b=y(b)?b:0;for(var c=new w(a.length+Math.abs(b)),d=-Math.min(b,0),f=Math.max(b,0),g=c.a().rows-Math.abs(b),h=1;h<=g;h++)c.d(h+d,h+f,a[h-1]);return c};w.diag=w.diag;w.random=function(a,b,c,d,f){b=y(b)?b:a;c=y(c)?c:D.random.M;d=y(d)?d:D.random.L;f=E(f,D.random.N);var g=new w(a,b);d=d-c+(f?1:0);for(var h,n=1;n<=a;n++)for(var s=1;s<=b;s++)h=c+Math.random()*d,f&&(h|=0),g.d(n,s,h);return g};function y(a){return"number"===typeof a}function z(a){return y(a)&&(a|0)===a}
function x(a){for(var b=0;b<a.length;b++)if(!y(a[b]))return m;return k}t.linspace=function(a,b,c){c=y(c)?c:1;for(var d=[];a<=b;a+=c)d.push(a);return d};function A(a,b){for(var c=[],d=1;d<=a;d++)c[d-1]=b;return c}t.repeat=A;function G(a){if(!(a instanceof w))return a;a.i()||e(new u(v.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.o("max")!==a.a().rows&&(b=b.w());a=[];for(var c=b.a().rows,d=1;d<=c;d++)a.push(b.b(d,1));return a}function K(a,b){return"string"===typeof a?a:b}
function E(a,b){return"boolean"===typeof a?a:b}var N={all:function(){return k},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};t.filters=N;var O={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};t.applicators=O;Array.prototype.r=function(a,b){return new w(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.r);Array.prototype.V=function(a){a=E(a,m);return new w(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.V);
String.prototype.r=function(a,b){a=K(a,"\r\n");b=K(b,"\t");for(var c=this.split(a),d,f=0,g=new w(0),h=0;h<c.length;h++){d=c[h].split(b);0===f&&(f=d.length,g=new w(c.length,f));d.length!==f&&e(new u(v.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var n=1;n<=f;n++)g.d(h+1,n,Number(d[n-1]))}return g};q("String.prototype.toMatrix",String.prototype.r);
