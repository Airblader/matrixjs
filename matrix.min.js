function e(a){throw a;}var l=!0,m=null,n=!1;function p(a){return function(){return a}}var q=this;Math.random();function r(a,b){var c=a.split("."),d=q;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?d[f]=b:d=d[f]?d[f]:d[f]={}};function s(){this.constructor=m;this.b=p(m);this.d=function(){return this};this.rows=p(m);this.a=p(m);e(Error("MatrixCommon cannot be instantiated"))}r("MatrixCommon",s);function u(){e(Error("This cannot be instantiated"))}r("MatrixUtils",u);function v(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}r("MatrixError",v);
var w={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};v.ErrorCodes=w;
function y(a){var b=[].slice.call(arguments),c,d,f=[];this.b=function(a,b){return f[d*(a-1)+b-1]};this.d=function(a,b,c){f[d*(a-1)+b-1]=c;return this};this.rows=function(){return c};this.a=function(){return d};this.C=function(){return f};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;d=-1;for(var a=0;a<b[0].length;a++)b[0][a].length!==d&&-1!==d&&e(new v(w.INVALID_PARAMETERS,"Number of columns must be the same for all rows")),z(b[0][a])||
e(new v(w.INVALID_PARAMETERS,"Elements must be numbers")),d=Math.max(d,b[0][a].length),f=f.concat(b[0][a])}else if(1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||A(b[0][0]))){z(b[0])||e(new v(w.INVALID_PARAMETERS,"Elements must be numbers"));f=b[0];var a=b[1],g=b[2];!A(a)&&!A(g)?a=g=Math.sqrt(f.length):!A(a)&&B(g)?a=f.length/g:B(a)&&!A(g)&&(g=f.length/a);(!B(a)||!B(g))&&e(new v(w.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given"));c=a;d=g}else 1===b.length&&
B(b[0])?(c=b[0],d=b[0],f=C(c*d,0)):2===b.length&&B(b[0])&&B(b[1])?(c=b[0],d=b[1],f=C(c*d,0)):e(new v(w.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}r("Matrix",y);y.prototype=Object.create(s.prototype);y.prototype.constructor=y;
function D(a){[].slice.call(arguments);var b,c=[],d=[],f=[];this.b=function(a,b){for(var k=f[a-1];k<f[a];k++)if(d[k]===b)return c[k];return 0};this.d=function(a,b,k){var t=f[a];c.splice(t,0,k);for(d.splice(t,0,b);a<f.length;a++)f[a]+=1;return this};this.rows=function(){return f.length-1};this.a=function(){return b};c=[1,2,3];d=[1,2,3];f=[0,1,2,3];b=3;return this}r("SparseMatrix",D);D.prototype=Object.create(s.prototype);D.prototype.constructor=D;
r("Vector",function(a){[].slice.call(arguments);var b=[];this.b=function(a,d){return b[d-1]};this.d=function(a,d,f){b[d-1]=f;return this};this.rows=p(1);this.a=function(){return b.length};return this});var E={stringify:{U:"\r\n",G:"\t"},l:{mode:"both"},m:{J:0},s:{which:"max"},random:{Q:0,P:1,R:l}};s.options=E;s.prototype.c=function(a,b){var c=this.constructor;if(a.i&&this.r())for(var d=0;d<a.i.length;d++)a.i[d].r()||(c=y);return new (c.bind.apply(c,[m].concat([].slice.call(arguments,1))))};
s.prototype.get=function(a,b){this.e(a,b)||e(new v(w.OUT_OF_BOUNDS));return this.b(a,b)};s.prototype.get=s.prototype.get;s.prototype.set=function(a,b,c){this.e(a,b)||e(new v(w.OUT_OF_BOUNDS));A(c)||e(new v(w.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};s.prototype.set=s.prototype.set;s.prototype.N=function(a,b){b=F(b,n);this.e(a,m)||e(new v(w.OUT_OF_BOUNDS));return G(this,a,b)};s.prototype.getRow=s.prototype.N;
function G(a,b,c){for(var d=[],f=a.a(),h=1;h<=f;h++)d.push(a.b(b,h));return c?a.c({},d,1):d}s.prototype.W=function(a,b){b=I(b);this.e(a,m)||e(new v(w.OUT_OF_BOUNDS));b.length!==this.a()&&e(new v(w.INVALID_PARAMETERS,"Wrong number of columns in row."));return J(this,a,b)};s.prototype.setRow=s.prototype.W;function J(a,b,c){for(var d=a.a(),f=1;f<=d;f++)a.d(b,f,c[f-1]);return a}s.prototype.M=function(a,b){b=F(b,n);this.e(m,a)||e(new v(w.OUT_OF_BOUNDS));return K(this,a,b)};s.prototype.getColumn=s.prototype.M;
function K(a,b,c){for(var d=[],f=a.rows(),h=1;h<=f;h++)d.push(a.b(h,b));return c?a.c({},d,m,1):d}s.prototype.V=function(a,b){b=I(b);this.e(m,a)||e(new v(w.OUT_OF_BOUNDS));b.length!==this.rows()&&e(new v(w.INVALID_PARAMETERS,"Wrong number of rows in column"));return L(this,a,b)};s.prototype.setColumn=s.prototype.V;function L(a,b,c){for(var d=a.rows(),f=1;f<=d;f++)a.d(f,b,c[f-1]);return a}s.prototype.k=function(a){return this.rows()===a.rows()&&this.a()===a.a()};s.prototype.isSameSizeAs=s.prototype.k;
s.prototype.r=function(){return this instanceof D};s.prototype.isSparse=s.prototype.r;s.prototype.h=function(){return 1===this.q("min")};s.prototype.isVector=s.prototype.h;s.prototype.g=function(){return this.rows()===this.a()};s.prototype.isSquare=s.prototype.g;s.prototype.O=function(){this.g()||e(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.b(b,c)!==this.b(c,b))return n;return l};s.prototype.isSymmetric=s.prototype.O;
s.prototype.l=function(a){a=M(a,E.l.mode);this.g()||e(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return N(this,n);case "upper":return N(this,l);case "both":return N(this,l)||N(this,n);default:e(new v(w.INVALID_PARAMETERS,"Mode not supported"))}};s.prototype.isTriangular=s.prototype.l;function N(a,b){for(var c=b?1:-1,d,f,h=a.rows(),g=1;g<h;g++){d=a.diag(c*g);f=d.length;for(var k=0;k<f;k++)if(0!==d[k])return n}return l}
s.prototype.copy=function(){return this.c({},this.n(),this.rows(),this.a())};s.prototype.copy=s.prototype.copy;s.prototype.size=function(){return this.rows()*this.a()};s.prototype.size=s.prototype.size;s.prototype.q=function(a){switch(a){case 1:case "rows":return this.rows();case 2:case "columns":return this.a();case "max":return Math.max(this.rows(),this.a());case "min":return Math.min(this.rows(),this.a());default:e(new v(w.INVALID_PARAMETERS,"Parameter must match a known value"))}};
s.prototype.dim=s.prototype.q;s.prototype.add=function(a){var b=this.rows(),c=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(this.add(b.shift()),b);this.k(a)||e(new v(w.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.c({i:[a]},b,c),f,h,g=1;g<=b;g++){f=G(this,g,n);h=G(a,g,n);for(var k=0;k<c;k++)f[k]+=h[k];J(d,g,f)}return d};s.prototype.add=s.prototype.add;
s.prototype.t=function(a){var b=this.rows(),c=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.t.apply(this.t(b.shift()),b);this.k(a)||e(new v(w.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.c({i:[a]},b,c),f,h,g=1;g<=b;g++){f=G(this,g,n);h=G(a,g,n);for(var k=0;k<c;k++)f[k]-=h[k];J(d,g,f)}return d};s.prototype.subtract=s.prototype.t;
s.prototype.scale=function(a){A(a)||e(new v(w.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.rows(),c=this.a(),d=this.c({},b,c),f,h=1;h<=b;h++){f=G(this,h,n);for(var g=0;g<c;g++)f[g]*=a;J(d,h,f)}return d};s.prototype.scale=s.prototype.scale;
s.prototype.multiply=function(a){var b=this.rows(),c=this.a(),d=a.a();c!==a.rows()&&e(new v(w.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=this.c({i:[a]},b,d),h=1;h<=b;h++)for(var g=1;g<=d;g++){for(var k=0,t=G(this,h,n),x=K(a,g,n),H=0;H<c;H++)k+=t[H]*x[H];f.d(h,g,k)}return f};s.prototype.multiply=s.prototype.multiply;s.prototype.B=function(){for(var a=this.rows(),b=this.c({},this.a(),a),c=1;c<=a;c++)L(b,c,G(this,c,n));return b};s.prototype.transpose=s.prototype.B;
s.prototype.trace=function(){this.g()||e(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=0,c=1;c<=a;c++)b+=this.b(c,c);return b};s.prototype.trace=s.prototype.trace;
s.prototype.p=function(){var a=0,b=this.copy(),c,d,f,h,g,k=this.rows(),t=this.a(),x;for(f=1;f<=k;f++){d=0;g=-1;h=K(b,f,n);for(c=f;c<=k;c++)x=Math.abs(h[c-1]),x>=g&&(d=c,g=x);0===h[d-1]&&e(new v(w.MATRIX_IS_SINGULAR));d!==f&&(c=G(b,d,n),J(b,d,G(b,f,n)),J(b,f,c),a++);h=G(b,f,n);for(c=f+1;c<=k;c++){g=G(b,c,n);for(d=f;d<t;d++)g[d]-=h[d]*g[f-1]/h[f-1];g[f-1]=0;J(b,c,g)}}b.Y=a;return b};s.prototype.decomposeLU=s.prototype.p;
s.prototype.I=function(){var a,b,c,d=this.rows();this.g()||e(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));if(this.l())b=1,c=this.diag();else{try{a=this.p()}catch(f){if(f.code&&f.code===w.MATRIX_IS_SINGULAR)return 0;e(f)}b=Math.pow(-1,a.Y);c=a.diag()}for(a=0;a<d;a++)b*=c[a];return b};s.prototype.det=s.prototype.I;
s.prototype.inverse=function(){this.g()||e(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.o(O(this.rows())),b,c,d,f,h,g,k,t,x;try{a=a.p();t=a.rows();x=a.a();for(f=t;1<f;f--){c=G(a,f-1,n);b=G(a,f,n);k=c[f-1]/b[f-1];d=[];for(g=0;g<x;g++)d[g]=c[g]-b[g]*k;J(a,f-1,d)}for(h=1;h<=t;h++){b=G(a,h,n);d=[];for(g=0;g<x;g++)d[g]=b[g]/b[h-1];J(a,h,d)}}catch(H){e(new v(w.MATRIX_IS_SINGULAR))}return a.A(1,t,this.a()+1,x)};s.prototype.inverse=s.prototype.inverse;
s.prototype.A=function(a,b,c,d){(!this.e(a,c)||!this.e(b,d)||a>b||c>d)&&e(new v(w.OUT_OF_BOUNDS));for(var f=this.c({},b-a+1,d-c+1),h=a;h<=b;h++)J(f,h-a+1,G(this,h,n).slice(c-1,d));return f};s.prototype.submatrix=s.prototype.A;s.prototype.o=function(a){var b=this.rows(),c=this.a(),d=a.a();b!==a.rows()&&e(new v(w.INVALID_PARAMETERS,"Number of rows must match"));for(var b=this.c({i:[a]},b,c+d),f=1;f<=c;f++)L(b,f,K(this,f,n));for(f=1;f<=d;f++)L(b,f+c,K(a,f,n));return b};s.prototype.augment=s.prototype.o;
s.prototype.K=function(a){var b=this.rows();(!this.h()||!a.h()||1!==this.a()||1!==a.a())&&e(new v(w.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.rows()&&e(new v(w.DIMENSION_MISMATCH));for(var c=0,d=1;d<=b;d++)c+=this.b(d,1)*a.b(d,1);return c};s.prototype.dot=s.prototype.K;s.prototype.round=function(){return this.m(0)};s.prototype.round=s.prototype.round;s.prototype.m=function(a){a=A(a)?a:E.m.J;var b=Math.pow(10,a);return this.f(function(a){return Math.round(a*b)/b})};
s.prototype.roundTo=s.prototype.m;s.prototype.abs=function(){return this.f(function(a){return Math.abs(a)})};s.prototype.abs=s.prototype.abs;s.prototype.H=function(a){(!this.h()||!a.h()||3!==this.rows()||3!==a.rows())&&e(new v(w.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return this.c({},[[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};s.prototype.cross=s.prototype.H;
s.prototype.F=function(a){a=I(a);for(var b=this.rows(),c=this.c({},b+1,this.a()),d=1;d<=b;d++)J(c,d,G(this,d,n));J(c,b+1,a);return c};s.prototype.addRow=s.prototype.F;s.prototype.D=function(a){return this.copy().o(this.c({},I(a),m,1))};s.prototype.addColumn=s.prototype.D;
s.prototype.contains=function(a,b){b=A(b)?b:0;var c=this.rows(),d=this.a(),f;(!A(a)||!A(b))&&e(new v(w.INVALID_PARAMETERS,"Parameter must be a number"));for(var h=1;h<=c;h++){f=G(this,h,n);for(var g=0;g<d;g++)if(0===b){if(f[g]===a)return l}else if(Math.abs(f[g]-a)<=b)return l}return n};s.prototype.contains=s.prototype.contains;s.prototype.stringify=function(a,b){a=M(a,E.stringify.U);b=M(b,E.stringify.G);for(var c=[],d,f=this.rows(),h=1;h<=f;h++)d=G(this,h,n),c.push(d.join(b));return c.join(a)};
s.prototype.stringify=s.prototype.stringify;s.prototype.L=function(a){var b=this.rows(),c=this.a(),d,f;if(!this.k(a))return n;for(var h=1;h<=b;h++){d=G(this,h,n);f=G(a,h,n);for(var g=0;g<c;g++)if(d[g]!==f[g])return n}return l};s.prototype.equals=s.prototype.L;
s.prototype.f=function(a,b){b=b||P.all;"function"!==typeof a&&e(new v(w.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&e(new v(w.INVALID_PARAMETERS,"Filter must be a function"));for(var c,d,f=this.rows(),h=this.a(),g=this.c({},f,h),k=1;k<=f;k++){d=G(this,k,n);for(var t=1;t<=h;t++)c=d[t-1],b(c,k,t)&&(d[t-1]=a(c,k,t));J(g,k,d)}return g};s.prototype.fun=s.prototype.f;s.prototype.X=function(a){return this.f(a,P.nonZero)};s.prototype.spfun=s.prototype.X;
s.prototype.S=function(){return this.f(Q.exp,m)};s.prototype.pw_exp=s.prototype.S;s.prototype.T=function(a){return this.f(function(b){return Math.pow(b,a)},m)};s.prototype.pw_pow=s.prototype.T;
s.prototype.s=function(a,b){a=M(a,E.s.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.j(Number(b));case "frobenius":return this.j(2);case "rows":case "rowsum":return this.z();case "columns":case "columnsum":return this.v();case "max":return this.w();default:e(new v(w.INVALID_PARAMETERS,"Norm not supported"))}};s.prototype.norm=s.prototype.s;
s.prototype.j=function(a){B(a)||e(new v(w.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.rows(),d=this.a(),f,h=1;h<=c;h++){f=G(this,h,n);for(var g=0;g<d;g++)b+=Math.pow(Math.abs(f[g]),a)}return Math.pow(b,1/a)};s.prototype.pnorm=s.prototype.j;s.prototype.w=function(){for(var a=0,b=this.rows(),c=this.a(),d,f=1;f<=b;f++){d=G(this,f,n);for(var h=0;h<c;h++)a=Math.max(a,Math.abs(d[h]))}return a};s.prototype.maxnorm=s.prototype.w;
s.prototype.z=function(){for(var a=0,b=this.rows(),c=1;c<=b;c++)a=Math.max(a,G(this,c,l).j(1));return a};s.prototype.rownorm=s.prototype.z;s.prototype.v=function(){for(var a=0,b=this.a(),c=1;c<=b;c++)a=Math.max(a,K(this,c,l).j(1));return a};s.prototype.columnnorm=s.prototype.v;s.prototype.diag=function(a){a=A(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var d=0===c?this.a()-a:this.rows()-c;0>=d&&e(new v(w.OUT_OF_BOUNDS));for(var f=1;f<=d;f++)b.push(this.b(f+c,f+a));return b};
s.prototype.diag=s.prototype.diag;s.prototype.e=function(a,b){return(!A(a)||1<=a&&a<=this.rows())&&(!A(b)||1<=b&&b<=this.a())};s.prototype.isInRange=s.prototype.e;s.prototype.n=function(){for(var a=this.rows(),b=[],c=1;c<=a;c++)b=b.concat(G(this,c,n));return b};s.prototype.toArray=s.prototype.n;y.prototype.n=function(){return[].slice.call(this.C())};y.prototype.toArray=y.prototype.n;y.zeros=function(a,b){b=A(b)?b:a;return new y(a,b)};
y.ones=function(a,b){b=A(b)?b:a;for(var c=new y(a,b),d=1;d<=a;d++)for(var f=1;f<=b;f++)c.d(d,f,1);return c};function O(a){for(var b=new y(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}y.eye=O;y.diag=function(a,b){a=I(a);b=A(b)?b:0;for(var c=new y(a.length+Math.abs(b)),d=-Math.min(b,0),f=Math.max(b,0),h=c.rows()-Math.abs(b),g=1;g<=h;g++)c.d(g+d,g+f,a[g-1]);return c};y.diag=y.diag;
y.random=function(a,b,c,d,f){b=A(b)?b:a;c=A(c)?c:E.random.Q;d=A(d)?d:E.random.P;f=F(f,E.random.R);var h=new y(a,b);d=d-c+(f?1:0);for(var g,k=1;k<=a;k++)for(var t=1;t<=b;t++)g=c+Math.random()*d,f&&(g|=0),h.d(k,t,g);return h};function A(a){return"number"===typeof a}function B(a){return A(a)&&(a|0)===a}function z(a){for(var b=0;b<a.length;b++)if(!A(a[b]))return n;return l}u.linspace=function(a,b,c){c=A(c)?c:1;for(var d=[];a<=b;a+=c)d.push(a);return d};
function C(a,b){for(var c=[],d=1;d<=a;d++)c[d-1]=b;return c}u.repeat=C;function I(a){if(!(a instanceof s))return a;a.h()||e(new v(w.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.q("max")!==a.rows()&&(b=b.B());a=[];for(var c=b.rows(),d=1;d<=c;d++)a.push(b.b(d,1));return a}function M(a,b){return"string"===typeof a?a:b}function F(a,b){return"boolean"===typeof a?a:b}var P={all:p(l),nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};u.filters=P;
var Q={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};u.applicators=Q;Array.prototype.u=function(a,b){return new y(this,a,b)};r("Array.prototype.toMatrix",Array.prototype.u);Array.prototype.Z=function(a){a=F(a,n);return new y(this,a?1:this.length,a?this.length:1)};r("Array.prototype.toVector",Array.prototype.Z);
String.prototype.u=function(a,b){a=M(a,"\r\n");b=M(b,"\t");for(var c=this.split(a),d,f=0,h=new y(0),g=0;g<c.length;g++){d=c[g].split(b);0===f&&(f=d.length,h=new y(c.length,f));d.length!==f&&e(new v(w.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var k=1;k<=f;k++)h.d(g+1,k,Number(d[k-1]))}return h};r("String.prototype.toMatrix",String.prototype.u);
