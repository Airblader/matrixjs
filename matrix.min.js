function d(a){throw a;}var k=!0,l=null,m=!1,n=this;Math.random();function q(a,b){var c=a.split("."),e=n;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function r(a){var b=[].slice.call(arguments),c,e,f=[];this.t=function(a){return f[a]};this.u=function(a,b){f[a]=b;return this};this.a=function(){return{rows:c,b:e}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;e=-1;for(var a=0;a<b[0].length;a++){b[0][a].length!==e&&-1!==e&&d(new s(u.INVALID_PARAMETERS,"Number of columns must be the same for all rows"));v(b[0][a])||d(new s(u.INVALID_PARAMETERS,"Elements must be numbers"));e=Math.max(e,b[0][a].length);
for(var h=0;h<b[0][a].length;h++)f.push(b[0][a][h])}}else 1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||w(b[0][0]))?(v(b[0])||d(new s(u.INVALID_PARAMETERS,"Elements must be numbers")),f=b[0],a=b[1],h=b[2],!w(a)&&!w(h)?a=h=Math.sqrt(f.length):!w(a)&&x(h)?a=f.length/h:x(a)&&!w(h)&&(h=f.length/a),(!x(a)||!x(h))&&d(new s(u.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given")),c=a,e=h):1===b.length&&x(b[0])?(c=b[0],e=b[0],f=y(c*e,0)):2===b.length&&x(b[0])&&x(b[1])?
(c=b[0],e=b[1],f=y(c*e,0)):d(new s(u.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",r);var z={stringify:{O:"\r\n",z:"\t"},g:{mode:"both"},h:{C:0},l:{which:"max"},random:{K:0,J:1,L:k}};r.options=z;r.prototype.get=function(a,b){A(this,a,b)||d(new s(u.OUT_OF_BOUNDS));return B(this,a,b)};r.prototype.get=r.prototype.get;
r.prototype.set=function(a,b,c){A(this,a,b)||d(new s(u.OUT_OF_BOUNDS));w(c)||d(new s(u.INVALID_PARAMETERS,"Value has to be a number"));return C(this,a,b,c)};r.prototype.set=r.prototype.set;r.prototype.H=function(a,b){b=D(b,m);A(this,a,l)||d(new s(u.OUT_OF_BOUNDS));return E(this,a,b)};r.prototype.getRow=r.prototype.H;function E(a,b,c){for(var e=[],f=a.a().b,g=1;g<=f;g++)e.push(B(a,b,g));return c?new r(e,1):e}
r.prototype.Q=function(a,b){b=F(b);A(this,a,l)||d(new s(u.OUT_OF_BOUNDS));b.length!==this.a().b&&d(new s(u.INVALID_PARAMETERS,"Wrong number of columns in row."));return G(this,a,b)};r.prototype.setRow=r.prototype.Q;function G(a,b,c){for(var e=a.a().b,f=1;f<=e;f++)C(a,b,f,c[f-1]);return a}r.prototype.G=function(a,b){b=D(b,m);A(this,l,a)||d(new s(u.OUT_OF_BOUNDS));return H(this,a,b)};r.prototype.getColumn=r.prototype.G;
function H(a,b,c){for(var e=[],f=a.a().rows,g=1;g<=f;g++)e.push(B(a,g,b));return c?new r(e,l,1):e}r.prototype.P=function(a,b){b=F(b);A(this,l,a)||d(new s(u.OUT_OF_BOUNDS));b.length!==this.a().rows&&d(new s(u.INVALID_PARAMETERS,"Wrong number of rows in column"));return I(this,a,b)};r.prototype.setColumn=r.prototype.P;function I(a,b,c){for(var e=a.a().rows,f=1;f<=e;f++)C(a,f,b,c[f-1]);return a}r.prototype.d=function(){return 1===this.k("min")};r.prototype.isVector=r.prototype.d;
r.prototype.c=function(){return this.a().rows===this.a().b};r.prototype.isSquare=r.prototype.c;r.prototype.I=function(){this.c()||d(new s(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(B(this,b,c)!==B(this,c,b))return m;return k};r.prototype.isSymmetric=r.prototype.I;
r.prototype.g=function(a){a=J(a,z.g.mode);this.c()||d(new s(u.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return K(this,m);case "upper":return K(this,k);case "both":return K(this,k)||K(this,m);default:d(new s(u.INVALID_PARAMETERS,"Mode not supported"))}};r.prototype.isTriangular=r.prototype.g;function K(a,b){for(var c=b?1:-1,e,f,g=a.a().rows,h=1;h<g;h++){e=a.diag(c*h);f=e.length;for(var p=0;p<f;p++)if(0!==e[p])return m}return k}
r.prototype.copy=function(){for(var a=this.a().rows,b=new r(a,this.a().b),c=1;c<=a;c++)G(b,c,E(this,c,m));return b};r.prototype.copy=r.prototype.copy;r.prototype.size=function(){return this.a().rows*this.a().b};r.prototype.size=r.prototype.size;r.prototype.k=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.b;case "max":return Math.max(b.rows,b.b);case "min":return Math.min(b.rows,b.b);default:d(new s(u.INVALID_PARAMETERS,"Parameter must match a known value"))}};
r.prototype.dim=r.prototype.k;r.prototype.add=function(a){var b=this.a().rows,c=this.a().b;if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(Object(this.add(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().b)&&d(new s(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new r(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)C(e,f,g,B(this,f,g)+B(a,f,g));return e};r.prototype.add=r.prototype.add;
r.prototype.m=function(a){var b=this.a().rows,c=this.a().b;if(1<arguments.length)return b=[].slice.call(arguments),this.m.apply(Object(this.m(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().b)&&d(new s(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new r(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)C(e,f,g,B(this,f,g)-B(a,f,g));return e};r.prototype.subtract=r.prototype.m;
r.prototype.scale=function(a){w(a)||d(new s(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().b,e=new r(b,c),f=1;f<=b;f++)for(var g=1;g<=c;g++)C(e,f,g,a*B(this,f,g));return e};r.prototype.scale=r.prototype.scale;
r.prototype.multiply=function(a){var b=this.a().rows,c=this.a().b,e=a.a().b;c!==a.a().rows&&d(new s(u.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=new r(b,e),g=1;g<=b;g++)for(var h=1;h<=e;h++){for(var p=0,t=1;t<=c;t++)p+=B(this,g,t)*B(a,t,h);C(f,g,h,p)}return f};r.prototype.multiply=r.prototype.multiply;r.prototype.s=function(){for(var a=this.a().rows,b=new r(this.a().b,a),c=1;c<=a;c++)I(b,c,E(this,c,m));return b};r.prototype.transpose=r.prototype.s;
r.prototype.trace=function(){this.c()||d(new s(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=B(this,c,c);return b};r.prototype.trace=r.prototype.trace;
r.prototype.j=function(){var a=0,b=this.copy(),c,e,f,g=this.a().rows,h=this.a().b,p,t;for(f=1;f<=g;f++){e=0;p=-1;for(c=f;c<=g;c++)t=Math.abs(B(b,c,f)),t>=p&&(e=c,p=t);0===B(b,e,f)&&d(new s(u.MATRIX_IS_SINGULAR));e!==f&&(c=E(b,e,m),G(b,e,E(b,f,m)),G(b,f,c),a++);for(c=f+1;c<=g;c++){for(e=f+1;e<=h;e++)C(b,c,e,B(b,c,e)-B(b,f,e)*(B(b,c,f)/B(b,f,f)));C(b,c,f,0)}}b.S=a;return b};r.prototype.decomposeLU=r.prototype.j;
r.prototype.B=function(){var a,b,c=this.a().rows;this.c()||d(new s(u.DIMENSION_MISMATCH,"Matrix must be square"));if(this.g())for(a=b=1;a<=this.a().rows;a++)b*=B(this,a,a);else{try{var e=this.j()}catch(f){if(f.code&&f.code===u.MATRIX_IS_SINGULAR)return 0;d(f)}b=Math.pow(-1,e.S);for(a=1;a<=c;a++)b*=B(e,a,a)}return b};r.prototype.det=r.prototype.B;
r.prototype.inverse=function(){this.c()||d(new s(u.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.i(L(this.a().rows)),b,c,e,f,g,h,p;try{a=a.j();h=a.a().rows;p=a.a().b;for(c=h;1<c;c--){b=E(a,c,m);g=B(a,c-1,c)/B(a,c,c);for(f=0;f<p;f++)C(a,c-1,f+1,B(a,c-1,f+1)-b[f]*g)}for(e=1;e<=h;e++){b=E(a,e,m);for(f=0;f<p;f++)b[f]/=B(a,e,e);G(a,e,b)}}catch(t){d(new s(u.MATRIX_IS_SINGULAR))}return a.r(1,a.a().rows,this.a().b+1,a.a().b)};r.prototype.inverse=r.prototype.inverse;
r.prototype.r=function(a,b,c,e){(!A(this,a,c)||!A(this,b,e)||a>b||c>e)&&d(new s(u.OUT_OF_BOUNDS));for(var f=new r(b-a+1,e-c+1),g=a;g<=b;g++)G(f,g-a+1,E(this,g,m).slice(c-1,e));return f};r.prototype.submatrix=r.prototype.r;r.prototype.i=function(a){var b=this.a().b,c=a.a().b;this.a().rows!==a.a().rows&&d(new s(u.INVALID_PARAMETERS,"Number of rows must match"));for(var e=new r(this.a().rows,b+c),f=1;f<=b;f++)I(e,f,H(this,f,m));for(b=1;b<=c;b++)I(e,b+this.a().b,H(a,b,m));return e};
r.prototype.augment=r.prototype.i;r.prototype.D=function(a){var b=this.a().rows;(!this.d()||!a.d()||1!==this.a().b||1!==a.a().b)&&d(new s(u.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&d(new s(u.DIMENSION_MISMATCH));for(var c=0,e=1;e<=b;e++)c+=B(this,e,1)*B(a,e,1);return c};r.prototype.dot=r.prototype.D;r.prototype.round=function(){return this.h(0)};r.prototype.round=r.prototype.round;
r.prototype.h=function(a){a=w(a)?a:z.h.C;var b=this.copy();a=Math.pow(10,a);for(var c=b.a().rows,e=b.a().b,f=1;f<=c;f++)for(var g=1;g<=e;g++)C(b,f,g,Math.round(B(b,f,g)*a)/a);return b};r.prototype.roundTo=r.prototype.h;r.prototype.abs=function(){for(var a=this.copy(),b=a.a().rows,c=a.a().b,e=1;e<=b;e++)for(var f=1;f<=c;f++)C(a,e,f,Math.abs(B(a,e,f)));return a};r.prototype.abs=r.prototype.abs;
r.prototype.A=function(a){(!this.d()||!a.d()||3!==this.a().rows||3!==a.a().rows)&&d(new s(u.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return new r([[B(this,2,1)*B(a,3,1)-B(this,3,1)*B(a,2,1)],[B(this,3,1)*B(a,1,1)-B(this,1,1)*B(a,3,1)],[B(this,1,1)*B(a,2,1)-B(this,2,1)*B(a,1,1)]])};r.prototype.cross=r.prototype.A;r.prototype.w=function(a){a=F(a);for(var b=this.a().rows,c=new r(b+1,this.a().b),e=1;e<=b;e++)G(c,e,E(this,e,m));G(c,b+1,a);return c};
r.prototype.addRow=r.prototype.w;r.prototype.v=function(a){return this.copy().i(new r(F(a),l,1))};r.prototype.addColumn=r.prototype.v;r.prototype.contains=function(a,b){b=w(b)?b:0;var c=this.a().rows,e=this.a().b;(!w(a)||!w(b))&&d(new s(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var f=1;f<=c;f++)for(var g=1;g<=e;g++)if(0===b){if(B(this,f,g)===a)return k}else if(Math.abs(B(this,f,g)-a)<=b)return k;return m};r.prototype.contains=r.prototype.contains;
r.prototype.stringify=function(a,b){a=J(a,z.stringify.O);b=J(b,z.stringify.z);for(var c=[],e,f=this.a().rows,g=this.a().b,h=1;h<=f;h++){e=[];for(var p=1;p<=g;p++)e.push(B(this,h,p));c.push(e.join(b))}return c.join(a)};r.prototype.stringify=r.prototype.stringify;r.prototype.F=function(a){var b=this.a().rows,c=this.a().b;if(b!==a.a().rows||c!==a.a().b)return m;for(var e=1;e<=b;e++)for(var f=1;f<=c;f++)if(B(this,e,f)!==B(a,e,f))return m;return k};r.prototype.equals=r.prototype.F;
r.prototype.f=function(a,b){b=b||M.all;"function"!==typeof a&&d(new s(u.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&d(new s(u.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),e,f=c.a().rows,g=c.a().b,h=1;h<=f;h++)for(var p=1;p<=g;p++)e=B(c,h,p),b(e,h,p)&&C(c,h,p,a(e,h,p));return c};r.prototype.fun=r.prototype.f;r.prototype.R=function(a){return this.f(a,M.nonZero)};r.prototype.spfun=r.prototype.R;r.prototype.M=function(){return this.f(N.exp,l)};
r.prototype.pw_exp=r.prototype.M;r.prototype.N=function(a){return this.f(function(b){return Math.pow(b,a)},l)};r.prototype.pw_pow=r.prototype.N;r.prototype.l=function(a,b){a=J(a,z.l.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.e(Number(b));case "frobenius":return this.e(2);case "rows":case "rowsum":return this.q();case "columns":case "columnsum":return this.o();case "max":return this.p();default:d(new s(u.INVALID_PARAMETERS,"Norm not supported"))}};r.prototype.norm=r.prototype.l;
r.prototype.e=function(a){x(a)||d(new s(u.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,e=this.a().b,f=1;f<=c;f++)for(var g=1;g<=e;g++)b+=Math.pow(Math.abs(B(this,f,g)),a);return Math.pow(b,1/a)};r.prototype.pnorm=r.prototype.e;r.prototype.p=function(){for(var a=0,b=this.a().rows,c=this.a().b,e=1;e<=b;e++)for(var f=1;f<=c;f++)a=Math.max(a,Math.abs(B(this,e,f)));return a};r.prototype.maxnorm=r.prototype.p;
r.prototype.q=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,E(this,c,k).e(1));return a};r.prototype.rownorm=r.prototype.q;r.prototype.o=function(){for(var a=0,b=this.a().b,c=1;c<=b;c++)a=Math.max(a,H(this,c,k).e(1));return a};r.prototype.columnnorm=r.prototype.o;r.prototype.diag=function(a){a=w(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var e=0===c?this.a().b-a:this.a().rows-c;0>=e&&d(new s(u.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(B(this,f+c,f+a));return b};
r.prototype.diag=r.prototype.diag;Array.prototype.n=function(a,b){return new r(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.n);Array.prototype.T=function(a){a=D(a,m);return new r(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.T);
String.prototype.n=function(a,b){a=J(a,"\r\n");b=J(b,"\t");for(var c=this.split(a),e,f=0,g=new r(0),h=0;h<c.length;h++){e=c[h].split(b);0===f&&(f=e.length,g=new r(c.length,f));e.length!==f&&d(new s(u.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var p=1;p<=f;p++)C(g,h+1,p,Number(e[p-1]))}return g};q("String.prototype.toMatrix",String.prototype.n);function B(a,b,c){return a.t(a.a().b*(b-1)+c-1)}function C(a,b,c,e){return a.u(a.a().b*(b-1)+c-1,e)}
function A(a,b,c){return(!w(b)||1<=b&&b<=a.a().rows)&&(!w(c)||1<=c&&c<=a.a().b)}function w(a){return"number"===typeof a}function x(a){return w(a)&&(a|0)===a}function v(a){for(var b=0;b<a.length;b++)if(!w(a[b]))return m;return k}function F(a){if(!(a instanceof r))return a;a.d()||d(new s(u.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.k("max")!==a.a().rows&&(b=b.s());a=[];for(var c=b.a().rows,e=1;e<=c;e++)a.push(B(b,e,1));return a}function J(a,b){return"string"===typeof a?a:b}
function D(a,b){return"boolean"===typeof a?a:b}function s(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}r.MatrixError=s;var u={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular"};r.ErrorCodes=u;var M={all:function(){return k},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};
r.filters=M;var N={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};r.applicators=N;r.zeros=function(a,b){b=w(b)?b:a;return new r(a,b)};r.ones=function(a,b){b=w(b)?b:a;for(var c=new r(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)C(c,e,f,1);return c};function L(a){for(var b=new r(a,a),c=1;c<=a;c++)C(b,c,c,1);return b}r.eye=L;
r.diag=function(a,b){a=F(a);b=w(b)?b:0;for(var c=new r(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),g=c.a().rows-Math.abs(b),h=1;h<=g;h++)C(c,h+e,h+f,a[h-1]);return c};r.diag=r.diag;r.random=function(a,b,c,e,f){b=w(b)?b:a;c=w(c)?c:z.random.K;e=w(e)?e:z.random.J;f=D(f,z.random.L);var g=new r(a,b);e=e-c+(f?1:0);for(var h,p=1;p<=a;p++)for(var t=1;t<=b;t++)h=c+Math.random()*e,f&&(h|=0),C(g,p,t,h);return g};r.linspace=function(a,b,c){c=w(c)?c:1;for(var e=[];a<=b;a+=c)e.push(a);return e};
function y(a,b){for(var c=[],e=1;e<=a;e++)c[e-1]=b;return c}r.repeat=y;
