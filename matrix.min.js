function e(a){throw a;}var l=!0,m=null,n=!1,p=this;Math.random();function q(a,b){var c=a.split("."),d=p;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?d[f]=b:d=d[f]?d[f]:d[f]={}};function r(){this.constructor=m;this.c=function(){return m};this.d=function(){return this};this.a=function(){return{rows:m,b:m}};e(Error("MatrixCommon cannot be instantiated"))}q("MatrixCommon",r);function s(){e(Error("This cannot be instantiated"))}q("MatrixUtils",s);function t(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q("MatrixError",t);
var u={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};t.ErrorCodes=u;
function v(a){var b=[].slice.call(arguments),c,d,f=[];this.c=function(a,b){return f[d*(a-1)+b-1]};this.d=function(a,b,c){f[d*(a-1)+b-1]=c;return this};this.a=function(){return{rows:c,b:d}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;d=-1;for(var a=0;a<b[0].length;a++)b[0][a].length!==d&&-1!==d&&e(new t(u.INVALID_PARAMETERS,"Number of columns must be the same for all rows")),w(b[0][a])||e(new t(u.INVALID_PARAMETERS,"Elements must be numbers")),
d=Math.max(d,b[0][a].length),f=f.concat(b[0][a])}else if(1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||x(b[0][0]))){w(b[0])||e(new t(u.INVALID_PARAMETERS,"Elements must be numbers"));f=b[0];var a=b[1],g=b[2];!x(a)&&!x(g)?a=g=Math.sqrt(f.length):!x(a)&&y(g)?a=f.length/g:y(a)&&!x(g)&&(g=f.length/a);(!y(a)||!y(g))&&e(new t(u.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given"));c=a;d=g}else 1===b.length&&y(b[0])?(c=b[0],d=b[0],f=A(c*d,0)):2===b.length&&y(b[0])&&
y(b[1])?(c=b[0],d=b[1],f=A(c*d,0)):e(new t(u.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",v);v.prototype=Object.create(r.prototype);v.prototype.constructor=v;function B(){e(Error("Not yet implemented."))}q("SparseMatrix",B);B.prototype=Object.create(r.prototype);B.prototype.constructor=B;
q("Vector",function(a){[].slice.call(arguments);var b=[];this.c=function(a,d){return b[d-1]};this.d=function(a,d,f){b[d-1]=f;return this};this.a=function(){return{rows:1,b:b.length}};return this});var C={stringify:{S:"\r\n",D:"\t"},l:{mode:"both"},m:{H:0},r:{which:"max"},random:{O:0,N:1,P:l}};r.options=C;r.prototype.e=function(a,b){var c=this.constructor;if(a.j&&this.q())for(var d=0;d<a.j.length;d++)a.j[d].q()||(c=v);return new (c.bind.apply(c,[m].concat([].slice.call(arguments,1))))};
r.prototype.get=function(a,b){this.f(a,b)||e(new t(u.OUT_OF_BOUNDS));return this.c(a,b)};r.prototype.get=r.prototype.get;r.prototype.set=function(a,b,c){this.f(a,b)||e(new t(u.OUT_OF_BOUNDS));x(c)||e(new t(u.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};r.prototype.set=r.prototype.set;r.prototype.L=function(a,b){b=D(b,n);this.f(a,m)||e(new t(u.OUT_OF_BOUNDS));return E(this,a,b)};r.prototype.getRow=r.prototype.L;
function E(a,b,c){for(var d=[],f=a.a().b,h=1;h<=f;h++)d.push(a.c(b,h));return c?a.e({},d,1):d}r.prototype.U=function(a,b){b=G(b);this.f(a,m)||e(new t(u.OUT_OF_BOUNDS));b.length!==this.a().b&&e(new t(u.INVALID_PARAMETERS,"Wrong number of columns in row."));return H(this,a,b)};r.prototype.setRow=r.prototype.U;function H(a,b,c){for(var d=a.a().b,f=1;f<=d;f++)a.d(b,f,c[f-1]);return a}r.prototype.K=function(a,b){b=D(b,n);this.f(m,a)||e(new t(u.OUT_OF_BOUNDS));return I(this,a,b)};
r.prototype.getColumn=r.prototype.K;function I(a,b,c){for(var d=[],f=a.a().rows,h=1;h<=f;h++)d.push(a.c(h,b));return c?a.e({},d,m,1):d}r.prototype.T=function(a,b){b=G(b);this.f(m,a)||e(new t(u.OUT_OF_BOUNDS));b.length!==this.a().rows&&e(new t(u.INVALID_PARAMETERS,"Wrong number of rows in column"));return K(this,a,b)};r.prototype.setColumn=r.prototype.T;function K(a,b,c){for(var d=a.a().rows,f=1;f<=d;f++)a.d(f,b,c[f-1]);return a}r.prototype.q=function(){return this instanceof B};
r.prototype.isSparse=r.prototype.q;r.prototype.i=function(){return 1===this.p("min")};r.prototype.isVector=r.prototype.i;r.prototype.h=function(){return this.a().rows===this.a().b};r.prototype.isSquare=r.prototype.h;r.prototype.M=function(){this.h()||e(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.c(b,c)!==this.c(c,b))return n;return l};r.prototype.isSymmetric=r.prototype.M;
r.prototype.l=function(a){a=L(a,C.l.mode);this.h()||e(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return M(this,n);case "upper":return M(this,l);case "both":return M(this,l)||M(this,n);default:e(new t(u.INVALID_PARAMETERS,"Mode not supported"))}};r.prototype.isTriangular=r.prototype.l;function M(a,b){for(var c=b?1:-1,d,f,h=a.a().rows,g=1;g<h;g++){d=a.diag(c*g);f=d.length;for(var k=0;k<f;k++)if(0!==d[k])return n}return l}
r.prototype.copy=function(){for(var a=this.a().rows,b=this.e({},a,this.a().b),c=1;c<=a;c++)H(b,c,E(this,c,n));return b};r.prototype.copy=r.prototype.copy;r.prototype.size=function(){var a=this.a();return a.rows*a.b};r.prototype.size=r.prototype.size;r.prototype.p=function(a){var b=this.a();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.b;case "max":return Math.max(b.rows,b.b);case "min":return Math.min(b.rows,b.b);default:e(new t(u.INVALID_PARAMETERS,"Parameter must match a known value"))}};
r.prototype.dim=r.prototype.p;r.prototype.add=function(a){var b=this.a(),c=b.rows,b=b.b;if(1<arguments.length)return c=[].slice.call(arguments),this.add.apply(Object(this.add(c.shift())),Object(c));(c!==a.a().rows||b!==a.a().b)&&e(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.e({j:[a]},c,b),f,h,g=1;g<=c;g++){f=E(this,g,n);h=E(a,g,n);for(var k=0;k<b;k++)f[k]+=h[k];H(d,g,f)}return d};r.prototype.add=r.prototype.add;
r.prototype.s=function(a){var b=this.a().rows,c=this.a().b;if(1<arguments.length)return b=[].slice.call(arguments),this.s.apply(Object(this.s(b.shift())),Object(b));(b!==a.a().rows||c!==a.a().b)&&e(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var d=this.e({j:[a]},b,c),f,h,g=1;g<=b;g++){f=E(this,g,n);h=E(a,g,n);for(var k=0;k<c;k++)f[k]-=h[k];H(d,g,f)}return d};r.prototype.subtract=r.prototype.s;
r.prototype.scale=function(a){x(a)||e(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.a().rows,c=this.a().b,d=this.e({},b,c),f,h=1;h<=b;h++){f=E(this,h,n);for(var g=0;g<c;g++)f[g]*=a;H(d,h,f)}return d};r.prototype.scale=r.prototype.scale;
r.prototype.multiply=function(a){var b=this.a(),c=b.rows,b=b.b,d=a.a().b;b!==a.a().rows&&e(new t(u.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=this.e({j:[a]},c,d),h=1;h<=c;h++)for(var g=1;g<=d;g++){for(var k=0,z=E(this,h,n),F=I(a,g,n),J=0;J<b;J++)k+=z[J]*F[J];f.d(h,g,k)}return f};r.prototype.multiply=r.prototype.multiply;r.prototype.A=function(){for(var a=this.a().rows,b=this.e({},this.a().b,a),c=1;c<=a;c++)K(b,c,E(this,c,n));return b};r.prototype.transpose=r.prototype.A;
r.prototype.trace=function(){this.h()||e(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.a().rows,b=0,c=1;c<=a;c++)b+=this.c(c,c);return b};r.prototype.trace=r.prototype.trace;
r.prototype.o=function(){var a=0,b=this.copy(),c,d,f,h,g,k=this.a().rows,z=this.a().b,F;for(f=1;f<=k;f++){d=0;g=-1;h=I(b,f,n);for(c=f;c<=k;c++)F=Math.abs(h[c-1]),F>=g&&(d=c,g=F);0===h[d-1]&&e(new t(u.MATRIX_IS_SINGULAR));d!==f&&(c=E(b,d,n),H(b,d,E(b,f,n)),H(b,f,c),a++);h=E(b,f,n);for(c=f+1;c<=k;c++){g=E(b,c,n);for(d=f;d<z;d++)g[d]-=h[d]*g[f-1]/h[f-1];g[f-1]=0;H(b,c,g)}}b.W=a;return b};r.prototype.decomposeLU=r.prototype.o;
r.prototype.G=function(){var a,b,c,d=this.a().rows;this.h()||e(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));if(this.l())b=1,c=this.diag();else{try{a=this.o()}catch(f){if(f.code&&f.code===u.MATRIX_IS_SINGULAR)return 0;e(f)}b=Math.pow(-1,a.W);c=a.diag()}for(a=0;a<d;a++)b*=c[a];return b};r.prototype.det=r.prototype.G;
r.prototype.inverse=function(){this.h()||e(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.n(N(this.a().rows)),b,c,d,f,h,g,k;try{a=a.o();g=a.a().rows;k=a.a().b;for(c=g;1<c;c--){b=E(a,c,n);h=a.c(c-1,c)/a.c(c,c);for(f=0;f<k;f++)a.d(c-1,f+1,a.c(c-1,f+1)-b[f]*h)}for(d=1;d<=g;d++){b=E(a,d,n);for(f=0;f<k;f++)b[f]/=a.c(d,d);H(a,d,b)}}catch(z){e(new t(u.MATRIX_IS_SINGULAR))}return a.z(1,a.a().rows,this.a().b+1,a.a().b)};r.prototype.inverse=r.prototype.inverse;
r.prototype.z=function(a,b,c,d){(!this.f(a,c)||!this.f(b,d)||a>b||c>d)&&e(new t(u.OUT_OF_BOUNDS));for(var f=this.e({},b-a+1,d-c+1),h=a;h<=b;h++)H(f,h-a+1,E(this,h,n).slice(c-1,d));return f};r.prototype.submatrix=r.prototype.z;r.prototype.n=function(a){var b=this.a().b,c=a.a().b;this.a().rows!==a.a().rows&&e(new t(u.INVALID_PARAMETERS,"Number of rows must match"));for(var d=this.e({j:[a]},this.a().rows,b+c),f=1;f<=b;f++)K(d,f,I(this,f,n));for(b=1;b<=c;b++)K(d,b+this.a().b,I(a,b,n));return d};
r.prototype.augment=r.prototype.n;r.prototype.I=function(a){var b=this.a().rows;(!this.i()||!a.i()||1!==this.a().b||1!==a.a().b)&&e(new t(u.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.a().rows&&e(new t(u.DIMENSION_MISMATCH));for(var c=0,d=1;d<=b;d++)c+=this.c(d,1)*a.c(d,1);return c};r.prototype.dot=r.prototype.I;r.prototype.round=function(){return this.m(0)};r.prototype.round=r.prototype.round;
r.prototype.m=function(a){a=x(a)?a:C.m.H;var b=Math.pow(10,a);return this.g(function(a){return Math.round(a*b)/b})};r.prototype.roundTo=r.prototype.m;r.prototype.abs=function(){return this.g(function(a){return Math.abs(a)})};r.prototype.abs=r.prototype.abs;
r.prototype.F=function(a){(!this.i()||!a.i()||3!==this.a().rows||3!==a.a().rows)&&e(new t(u.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return this.e({},[[this.c(2,1)*a.c(3,1)-this.c(3,1)*a.c(2,1)],[this.c(3,1)*a.c(1,1)-this.c(1,1)*a.c(3,1)],[this.c(1,1)*a.c(2,1)-this.c(2,1)*a.c(1,1)]])};r.prototype.cross=r.prototype.F;r.prototype.C=function(a){a=G(a);for(var b=this.a().rows,c=this.e({},b+1,this.a().b),d=1;d<=b;d++)H(c,d,E(this,d,n));H(c,b+1,a);return c};
r.prototype.addRow=r.prototype.C;r.prototype.B=function(a){return this.copy().n(this.e({},G(a),m,1))};r.prototype.addColumn=r.prototype.B;r.prototype.contains=function(a,b){b=x(b)?b:0;var c=this.a().rows,d=this.a().b;(!x(a)||!x(b))&&e(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var f=1;f<=c;f++)for(var h=1;h<=d;h++)if(0===b){if(this.c(f,h)===a)return l}else if(Math.abs(this.c(f,h)-a)<=b)return l;return n};r.prototype.contains=r.prototype.contains;
r.prototype.stringify=function(a,b){a=L(a,C.stringify.S);b=L(b,C.stringify.D);for(var c=[],d,f=this.a().rows,h=this.a().b,g=1;g<=f;g++){d=[];for(var k=1;k<=h;k++)d.push(this.c(g,k));c.push(d.join(b))}return c.join(a)};r.prototype.stringify=r.prototype.stringify;r.prototype.J=function(a){var b=this.a().rows,c=this.a().b;if(b!==a.a().rows||c!==a.a().b)return n;for(var d=1;d<=b;d++)for(var f=1;f<=c;f++)if(this.c(d,f)!==a.c(d,f))return n;return l};r.prototype.equals=r.prototype.J;
r.prototype.g=function(a,b){b=b||O.all;"function"!==typeof a&&e(new t(u.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&e(new t(u.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),d,f=c.a().rows,h=c.a().b,g=1;g<=f;g++)for(var k=1;k<=h;k++)d=c.c(g,k),b(d,g,k)&&c.d(g,k,a(d,g,k));return c};r.prototype.fun=r.prototype.g;r.prototype.V=function(a){return this.g(a,O.nonZero)};r.prototype.spfun=r.prototype.V;r.prototype.Q=function(){return this.g(P.exp,m)};
r.prototype.pw_exp=r.prototype.Q;r.prototype.R=function(a){return this.g(function(b){return Math.pow(b,a)},m)};r.prototype.pw_pow=r.prototype.R;r.prototype.r=function(a,b){a=L(a,C.r.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.k(Number(b));case "frobenius":return this.k(2);case "rows":case "rowsum":return this.w();case "columns":case "columnsum":return this.u();case "max":return this.v();default:e(new t(u.INVALID_PARAMETERS,"Norm not supported"))}};r.prototype.norm=r.prototype.r;
r.prototype.k=function(a){y(a)||e(new t(u.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.a().rows,d=this.a().b,f=1;f<=c;f++)for(var h=1;h<=d;h++)b+=Math.pow(Math.abs(this.c(f,h)),a);return Math.pow(b,1/a)};r.prototype.pnorm=r.prototype.k;r.prototype.v=function(){for(var a=0,b=this.a().rows,c=this.a().b,d=1;d<=b;d++)for(var f=1;f<=c;f++)a=Math.max(a,Math.abs(this.c(d,f)));return a};r.prototype.maxnorm=r.prototype.v;
r.prototype.w=function(){for(var a=0,b=this.a().rows,c=1;c<=b;c++)a=Math.max(a,E(this,c,l).k(1));return a};r.prototype.rownorm=r.prototype.w;r.prototype.u=function(){for(var a=0,b=this.a().b,c=1;c<=b;c++)a=Math.max(a,I(this,c,l).k(1));return a};r.prototype.columnnorm=r.prototype.u;r.prototype.diag=function(a){a=x(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var d=0===c?this.a().b-a:this.a().rows-c;0>=d&&e(new t(u.OUT_OF_BOUNDS));for(var f=1;f<=d;f++)b.push(this.c(f+c,f+a));return b};
r.prototype.diag=r.prototype.diag;r.prototype.f=function(a,b){return(!x(a)||1<=a&&a<=this.a().rows)&&(!x(b)||1<=b&&b<=this.a().b)};r.prototype.isInRange=r.prototype.f;v.zeros=function(a,b){b=x(b)?b:a;return new v(a,b)};v.ones=function(a,b){b=x(b)?b:a;for(var c=new v(a,b),d=1;d<=a;d++)for(var f=1;f<=b;f++)c.d(d,f,1);return c};function N(a){for(var b=new v(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}v.eye=N;
v.diag=function(a,b){a=G(a);b=x(b)?b:0;for(var c=new v(a.length+Math.abs(b)),d=-Math.min(b,0),f=Math.max(b,0),h=c.a().rows-Math.abs(b),g=1;g<=h;g++)c.d(g+d,g+f,a[g-1]);return c};v.diag=v.diag;v.random=function(a,b,c,d,f){b=x(b)?b:a;c=x(c)?c:C.random.O;d=x(d)?d:C.random.N;f=D(f,C.random.P);var h=new v(a,b);d=d-c+(f?1:0);for(var g,k=1;k<=a;k++)for(var z=1;z<=b;z++)g=c+Math.random()*d,f&&(g|=0),h.d(k,z,g);return h};function x(a){return"number"===typeof a}function y(a){return x(a)&&(a|0)===a}
function w(a){for(var b=0;b<a.length;b++)if(!x(a[b]))return n;return l}s.linspace=function(a,b,c){c=x(c)?c:1;for(var d=[];a<=b;a+=c)d.push(a);return d};function A(a,b){for(var c=[],d=1;d<=a;d++)c[d-1]=b;return c}s.repeat=A;function G(a){if(!(a instanceof r))return a;a.i()||e(new t(u.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.p("max")!==a.a().rows&&(b=b.A());a=[];for(var c=b.a().rows,d=1;d<=c;d++)a.push(b.c(d,1));return a}function L(a,b){return"string"===typeof a?a:b}
function D(a,b){return"boolean"===typeof a?a:b}var O={all:function(){return l},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};s.filters=O;var P={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};s.applicators=P;Array.prototype.t=function(a,b){return new v(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.t);Array.prototype.X=function(a){a=D(a,n);return new v(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.X);
String.prototype.t=function(a,b){a=L(a,"\r\n");b=L(b,"\t");for(var c=this.split(a),d,f=0,h=new v(0),g=0;g<c.length;g++){d=c[g].split(b);0===f&&(f=d.length,h=new v(c.length,f));d.length!==f&&e(new t(u.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var k=1;k<=f;k++)h.d(g+1,k,Number(d[k-1]))}return h};q("String.prototype.toMatrix",String.prototype.t);
