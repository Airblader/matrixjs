function d(a){throw a;}var k=!0,l=null,m=!1;function p(a){return function(){return a}}var q=this;Math.random();function r(a,b){var c=a.split("."),e=q;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function s(){this.constructor=l;this.b=p(l);this.d=function(){return this};this.k=function(){return{rows:l,a:l}};this.rows=p(l);this.a=p(l);d(Error("MatrixCommon cannot be instantiated"))}r("MatrixCommon",s);function u(){d(Error("This cannot be instantiated"))}r("MatrixUtils",u);function v(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}r("MatrixError",v);
var w={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};v.ErrorCodes=w;
function y(a){var b=[].slice.call(arguments),c,e,f=[];this.b=function(a,b){return f[e*(a-1)+b-1]};this.d=function(a,b,c){f[e*(a-1)+b-1]=c;return this};this.k=function(){return{rows:c,a:e}};this.rows=function(){return c};this.a=function(){return e};this.D=function(){return f};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;e=-1;for(var a=0;a<b[0].length;a++)b[0][a].length!==e&&-1!==e&&d(new v(w.INVALID_PARAMETERS,"Number of columns must be the same for all rows")),
z(b[0][a])||d(new v(w.INVALID_PARAMETERS,"Elements must be numbers")),e=Math.max(e,b[0][a].length),f=f.concat(b[0][a])}else if(1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||A(b[0][0]))){z(b[0])||d(new v(w.INVALID_PARAMETERS,"Elements must be numbers"));f=b[0];var a=b[1],g=b[2];!A(a)&&!A(g)?a=g=Math.sqrt(f.length):!A(a)&&B(g)?a=f.length/g:B(a)&&!A(g)&&(g=f.length/a);(!B(a)||!B(g))&&d(new v(w.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given"));c=a;e=g}else 1===
b.length&&B(b[0])?(c=b[0],e=b[0],f=C(c*e,0)):2===b.length&&B(b[0])&&B(b[1])?(c=b[0],e=b[1],f=C(c*e,0)):d(new v(w.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}r("Matrix",y);y.prototype=Object.create(s.prototype);y.prototype.constructor=y;function D(){d(Error("Not yet implemented."))}r("SparseMatrix",D);D.prototype=Object.create(s.prototype);D.prototype.constructor=D;
r("Vector",function(a){[].slice.call(arguments);var b=[];this.b=function(a,e){return b[e-1]};this.d=function(a,e,f){b[e-1]=f;return this};this.k=function(){return{rows:1,a:b.length}};this.rows=function(){};this.a=function(){};return this});var E={stringify:{V:"\r\n",H:"\t"},m:{mode:"both"},n:{K:0},t:{which:"max"},random:{R:0,Q:1,S:k}};s.options=E;
s.prototype.c=function(a,b){var c=this.constructor;if(a.i&&this.s())for(var e=0;e<a.i.length;e++)a.i[e].s()||(c=y);return new (c.bind.apply(c,[l].concat([].slice.call(arguments,1))))};s.prototype.get=function(a,b){this.e(a,b)||d(new v(w.OUT_OF_BOUNDS));return this.b(a,b)};s.prototype.get=s.prototype.get;s.prototype.set=function(a,b,c){this.e(a,b)||d(new v(w.OUT_OF_BOUNDS));A(c)||d(new v(w.INVALID_PARAMETERS,"Value has to be a number"));return this.d(a,b,c)};s.prototype.set=s.prototype.set;
s.prototype.O=function(a,b){b=F(b,m);this.e(a,l)||d(new v(w.OUT_OF_BOUNDS));return H(this,a,b)};s.prototype.getRow=s.prototype.O;function H(a,b,c){for(var e=[],f=a.a(),h=1;h<=f;h++)e.push(a.b(b,h));return c?a.c({},e,1):e}s.prototype.X=function(a,b){b=I(b);this.e(a,l)||d(new v(w.OUT_OF_BOUNDS));b.length!==this.a()&&d(new v(w.INVALID_PARAMETERS,"Wrong number of columns in row."));return J(this,a,b)};s.prototype.setRow=s.prototype.X;
function J(a,b,c){for(var e=a.a(),f=1;f<=e;f++)a.d(b,f,c[f-1]);return a}s.prototype.N=function(a,b){b=F(b,m);this.e(l,a)||d(new v(w.OUT_OF_BOUNDS));return K(this,a,b)};s.prototype.getColumn=s.prototype.N;function K(a,b,c){for(var e=[],f=a.rows(),h=1;h<=f;h++)e.push(a.b(h,b));return c?a.c({},e,l,1):e}s.prototype.W=function(a,b){b=I(b);this.e(l,a)||d(new v(w.OUT_OF_BOUNDS));b.length!==this.rows()&&d(new v(w.INVALID_PARAMETERS,"Wrong number of rows in column"));return L(this,a,b)};
s.prototype.setColumn=s.prototype.W;function L(a,b,c){for(var e=a.rows(),f=1;f<=e;f++)a.d(f,b,c[f-1]);return a}s.prototype.l=function(a){return this.rows()===a.rows()&&this.a()===a.a()};s.prototype.isSameSizeAs=s.prototype.l;s.prototype.s=function(){return this instanceof D};s.prototype.isSparse=s.prototype.s;s.prototype.h=function(){return 1===this.r("min")};s.prototype.isVector=s.prototype.h;s.prototype.g=function(){return this.rows()===this.a()};s.prototype.isSquare=s.prototype.g;
s.prototype.P=function(){this.g()||d(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=2;b<=a;b++)for(var c=1;c<b;c++)if(this.b(b,c)!==this.b(c,b))return m;return k};s.prototype.isSymmetric=s.prototype.P;s.prototype.m=function(a){a=M(a,E.m.mode);this.g()||d(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return N(this,m);case "upper":return N(this,k);case "both":return N(this,k)||N(this,m);default:d(new v(w.INVALID_PARAMETERS,"Mode not supported"))}};
s.prototype.isTriangular=s.prototype.m;function N(a,b){for(var c=b?1:-1,e,f,h=a.rows(),g=1;g<h;g++){e=a.diag(c*g);f=e.length;for(var n=0;n<f;n++)if(0!==e[n])return m}return k}s.prototype.copy=function(){return this.c({},this.o(),this.rows(),this.a())};s.prototype.copy=s.prototype.copy;s.prototype.size=function(){return this.rows()*this.a()};s.prototype.size=s.prototype.size;
s.prototype.r=function(a){switch(a){case 1:case "rows":return this.rows();case 2:case "columns":return this.a();case "max":return a=this.k(),Math.max(a.rows,a.a);case "min":return a=this.k(),Math.min(a.rows,a.a);default:d(new v(w.INVALID_PARAMETERS,"Parameter must match a known value"))}};s.prototype.dim=s.prototype.r;
s.prototype.add=function(a){var b=this.rows(),c=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(this.add(b.shift()),b);this.l(a)||d(new v(w.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=this.c({i:[a]},b,c),f,h,g=1;g<=b;g++){f=H(this,g,m);h=H(a,g,m);for(var n=0;n<c;n++)f[n]+=h[n];J(e,g,f)}return e};s.prototype.add=s.prototype.add;
s.prototype.u=function(a){var b=this.rows(),c=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.u.apply(this.u(b.shift()),b);this.l(a)||d(new v(w.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=this.c({i:[a]},b,c),f,h,g=1;g<=b;g++){f=H(this,g,m);h=H(a,g,m);for(var n=0;n<c;n++)f[n]-=h[n];J(e,g,f)}return e};s.prototype.subtract=s.prototype.u;
s.prototype.scale=function(a){A(a)||d(new v(w.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.rows(),c=this.a(),e=this.c({},b,c),f,h=1;h<=b;h++){f=H(this,h,m);for(var g=0;g<c;g++)f[g]*=a;J(e,h,f)}return e};s.prototype.scale=s.prototype.scale;
s.prototype.multiply=function(a){var b=this.rows(),c=this.a(),e=a.a();c!==a.rows()&&d(new v(w.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=this.c({i:[a]},b,e),h=1;h<=b;h++)for(var g=1;g<=e;g++){for(var n=0,t=H(this,h,m),x=K(a,g,m),G=0;G<c;G++)n+=t[G]*x[G];f.d(h,g,n)}return f};s.prototype.multiply=s.prototype.multiply;s.prototype.C=function(){for(var a=this.rows(),b=this.c({},this.a(),a),c=1;c<=a;c++)L(b,c,H(this,c,m));return b};s.prototype.transpose=s.prototype.C;
s.prototype.trace=function(){this.g()||d(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=0,c=1;c<=a;c++)b+=this.b(c,c);return b};s.prototype.trace=s.prototype.trace;
s.prototype.q=function(){var a=0,b=this.copy(),c,e,f,h,g,n=this.rows(),t=this.a(),x;for(f=1;f<=n;f++){e=0;g=-1;h=K(b,f,m);for(c=f;c<=n;c++)x=Math.abs(h[c-1]),x>=g&&(e=c,g=x);0===h[e-1]&&d(new v(w.MATRIX_IS_SINGULAR));e!==f&&(c=H(b,e,m),J(b,e,H(b,f,m)),J(b,f,c),a++);h=H(b,f,m);for(c=f+1;c<=n;c++){g=H(b,c,m);for(e=f;e<t;e++)g[e]-=h[e]*g[f-1]/h[f-1];g[f-1]=0;J(b,c,g)}}b.Z=a;return b};s.prototype.decomposeLU=s.prototype.q;
s.prototype.J=function(){var a,b,c,e=this.rows();this.g()||d(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));if(this.m())b=1,c=this.diag();else{try{a=this.q()}catch(f){if(f.code&&f.code===w.MATRIX_IS_SINGULAR)return 0;d(f)}b=Math.pow(-1,a.Z);c=a.diag()}for(a=0;a<e;a++)b*=c[a];return b};s.prototype.det=s.prototype.J;
s.prototype.inverse=function(){this.g()||d(new v(w.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.p(O(this.rows())),b,c,e,f,h,g,n,t,x;try{a=a.q();t=a.rows();x=a.a();for(f=t;1<f;f--){c=H(a,f-1,m);b=H(a,f,m);n=c[f-1]/b[f-1];e=[];for(g=0;g<x;g++)e[g]=c[g]-b[g]*n;J(a,f-1,e)}for(h=1;h<=t;h++){b=H(a,h,m);e=[];for(g=0;g<x;g++)e[g]=b[g]/b[h-1];J(a,h,e)}}catch(G){d(new v(w.MATRIX_IS_SINGULAR))}return a.B(1,t,this.a()+1,x)};s.prototype.inverse=s.prototype.inverse;
s.prototype.B=function(a,b,c,e){(!this.e(a,c)||!this.e(b,e)||a>b||c>e)&&d(new v(w.OUT_OF_BOUNDS));for(var f=this.c({},b-a+1,e-c+1),h=a;h<=b;h++)J(f,h-a+1,H(this,h,m).slice(c-1,e));return f};s.prototype.submatrix=s.prototype.B;s.prototype.p=function(a){var b=this.rows(),c=this.a(),e=a.a();b!==a.rows()&&d(new v(w.INVALID_PARAMETERS,"Number of rows must match"));for(var b=this.c({i:[a]},b,c+e),f=1;f<=c;f++)L(b,f,K(this,f,m));for(f=1;f<=e;f++)L(b,f+c,K(a,f,m));return b};s.prototype.augment=s.prototype.p;
s.prototype.L=function(a){var b=this.rows();(!this.h()||!a.h()||1!==this.a()||1!==a.a())&&d(new v(w.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.rows()&&d(new v(w.DIMENSION_MISMATCH));for(var c=0,e=1;e<=b;e++)c+=this.b(e,1)*a.b(e,1);return c};s.prototype.dot=s.prototype.L;s.prototype.round=function(){return this.n(0)};s.prototype.round=s.prototype.round;s.prototype.n=function(a){a=A(a)?a:E.n.K;var b=Math.pow(10,a);return this.f(function(a){return Math.round(a*b)/b})};
s.prototype.roundTo=s.prototype.n;s.prototype.abs=function(){return this.f(function(a){return Math.abs(a)})};s.prototype.abs=s.prototype.abs;s.prototype.I=function(a){(!this.h()||!a.h()||3!==this.rows()||3!==a.rows())&&d(new v(w.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return this.c({},[[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};s.prototype.cross=s.prototype.I;
s.prototype.G=function(a){a=I(a);for(var b=this.rows(),c=this.c({},b+1,this.a()),e=1;e<=b;e++)J(c,e,H(this,e,m));J(c,b+1,a);return c};s.prototype.addRow=s.prototype.G;s.prototype.F=function(a){return this.copy().p(this.c({},I(a),l,1))};s.prototype.addColumn=s.prototype.F;
s.prototype.contains=function(a,b){b=A(b)?b:0;var c=this.rows(),e=this.a(),f;(!A(a)||!A(b))&&d(new v(w.INVALID_PARAMETERS,"Parameter must be a number"));for(var h=1;h<=c;h++){f=H(this,h,m);for(var g=0;g<e;g++)if(0===b){if(f[g]===a)return k}else if(Math.abs(f[g]-a)<=b)return k}return m};s.prototype.contains=s.prototype.contains;s.prototype.stringify=function(a,b){a=M(a,E.stringify.V);b=M(b,E.stringify.H);for(var c=[],e,f=this.rows(),h=1;h<=f;h++)e=H(this,h,m),c.push(e.join(b));return c.join(a)};
s.prototype.stringify=s.prototype.stringify;s.prototype.M=function(a){var b=this.rows(),c=this.a(),e,f;if(!this.l(a))return m;for(var h=1;h<=b;h++){e=H(this,h,m);f=H(a,h,m);for(var g=0;g<c;g++)if(e[g]!==f[g])return m}return k};s.prototype.equals=s.prototype.M;
s.prototype.f=function(a,b){b=b||P.all;"function"!==typeof a&&d(new v(w.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&d(new v(w.INVALID_PARAMETERS,"Filter must be a function"));for(var c,e,f=this.rows(),h=this.a(),g=this.c({},f,h),n=1;n<=f;n++){e=H(this,n,m);for(var t=1;t<=h;t++)c=e[t-1],b(c,n,t)&&(e[t-1]=a(c,n,t));J(g,n,e)}return g};s.prototype.fun=s.prototype.f;s.prototype.Y=function(a){return this.f(a,P.nonZero)};s.prototype.spfun=s.prototype.Y;
s.prototype.T=function(){return this.f(Q.exp,l)};s.prototype.pw_exp=s.prototype.T;s.prototype.U=function(a){return this.f(function(b){return Math.pow(b,a)},l)};s.prototype.pw_pow=s.prototype.U;
s.prototype.t=function(a,b){a=M(a,E.t.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.j(Number(b));case "frobenius":return this.j(2);case "rows":case "rowsum":return this.A();case "columns":case "columnsum":return this.w();case "max":return this.z();default:d(new v(w.INVALID_PARAMETERS,"Norm not supported"))}};s.prototype.norm=s.prototype.t;
s.prototype.j=function(a){B(a)||d(new v(w.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=this.rows(),e=this.a(),f,h=1;h<=c;h++){f=H(this,h,m);for(var g=0;g<e;g++)b+=Math.pow(Math.abs(f[g]),a)}return Math.pow(b,1/a)};s.prototype.pnorm=s.prototype.j;s.prototype.z=function(){for(var a=0,b=this.rows(),c=this.a(),e,f=1;f<=b;f++){e=H(this,f,m);for(var h=0;h<c;h++)a=Math.max(a,Math.abs(e[h]))}return a};s.prototype.maxnorm=s.prototype.z;
s.prototype.A=function(){for(var a=0,b=this.rows(),c=1;c<=b;c++)a=Math.max(a,H(this,c,k).j(1));return a};s.prototype.rownorm=s.prototype.A;s.prototype.w=function(){for(var a=0,b=this.a(),c=1;c<=b;c++)a=Math.max(a,K(this,c,k).j(1));return a};s.prototype.columnnorm=s.prototype.w;s.prototype.diag=function(a){a=A(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var e=0===c?this.a()-a:this.rows()-c;0>=e&&d(new v(w.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(this.b(f+c,f+a));return b};
s.prototype.diag=s.prototype.diag;s.prototype.e=function(a,b){return(!A(a)||1<=a&&a<=this.rows())&&(!A(b)||1<=b&&b<=this.a())};s.prototype.isInRange=s.prototype.e;s.prototype.o=function(){for(var a=this.rows(),b=[],c=1;c<=a;c++)b=b.concat(H(this,c,m));return b};s.prototype.toArray=s.prototype.o;y.prototype.o=function(){return[].slice.call(this.D())};y.prototype.toArray=y.prototype.o;y.zeros=function(a,b){b=A(b)?b:a;return new y(a,b)};
y.ones=function(a,b){b=A(b)?b:a;for(var c=new y(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)c.d(e,f,1);return c};function O(a){for(var b=new y(a,a),c=1;c<=a;c++)b.d(c,c,1);return b}y.eye=O;y.diag=function(a,b){a=I(a);b=A(b)?b:0;for(var c=new y(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),h=c.rows()-Math.abs(b),g=1;g<=h;g++)c.d(g+e,g+f,a[g-1]);return c};y.diag=y.diag;
y.random=function(a,b,c,e,f){b=A(b)?b:a;c=A(c)?c:E.random.R;e=A(e)?e:E.random.Q;f=F(f,E.random.S);var h=new y(a,b);e=e-c+(f?1:0);for(var g,n=1;n<=a;n++)for(var t=1;t<=b;t++)g=c+Math.random()*e,f&&(g|=0),h.d(n,t,g);return h};function A(a){return"number"===typeof a}function B(a){return A(a)&&(a|0)===a}function z(a){for(var b=0;b<a.length;b++)if(!A(a[b]))return m;return k}u.linspace=function(a,b,c){c=A(c)?c:1;for(var e=[];a<=b;a+=c)e.push(a);return e};
function C(a,b){for(var c=[],e=1;e<=a;e++)c[e-1]=b;return c}u.repeat=C;function I(a){if(!(a instanceof s))return a;a.h()||d(new v(w.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.r("max")!==a.rows()&&(b=b.C());a=[];for(var c=b.rows(),e=1;e<=c;e++)a.push(b.b(e,1));return a}function M(a,b){return"string"===typeof a?a:b}function F(a,b){return"boolean"===typeof a?a:b}var P={all:p(k),nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};u.filters=P;
var Q={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};u.applicators=Q;Array.prototype.v=function(a,b){return new y(this,a,b)};r("Array.prototype.toMatrix",Array.prototype.v);Array.prototype.$=function(a){a=F(a,m);return new y(this,a?1:this.length,a?this.length:1)};r("Array.prototype.toVector",Array.prototype.$);
String.prototype.v=function(a,b){a=M(a,"\r\n");b=M(b,"\t");for(var c=this.split(a),e,f=0,h=new y(0),g=0;g<c.length;g++){e=c[g].split(b);0===f&&(f=e.length,h=new y(c.length,f));e.length!==f&&d(new v(w.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var n=1;n<=f;n++)h.d(g+1,n,Number(e[n-1]))}return h};r("String.prototype.toMatrix",String.prototype.v);
