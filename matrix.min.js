function c(a){throw a;}var l=!0,m=null,n=!1,p=this;Math.random();function q(a,b){var d=a.split("."),e=p;!(d[0]in e)&&e.execScript&&e.execScript("var "+d[0]);for(var f;d.length&&(f=d.shift());)!d.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function r(){c(Error("This cannot be instantiated"))}q("MatrixUtils",r);function t(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q("MatrixError",t);var u={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular",UNKNOWN_TYPE:"Unknown type"};t.ErrorCodes=u;
function w(a){var b=[].slice.call(arguments),d,e,f=[];this.b=function(a,b){return f[e*(a-1)+b-1]};this.c=function(a,b,d){f[e*(a-1)+b-1]=d;return this};this.rows=function(){return d};this.a=function(){return e};this.z=function(){return f};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){d=b[0].length;e=-1;for(var a=0;a<b[0].length;a++)b[0][a].length!==e&&-1!==e&&c(new t(u.INVALID_PARAMETERS,"Number of columns must be the same for all rows")),x(b[0][a])||
c(new t(u.INVALID_PARAMETERS,"Elements must be numbers")),e=Math.max(e,b[0][a].length),f=f.concat(b[0][a])}else if(1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||y(b[0][0]))){x(b[0])||c(new t(u.INVALID_PARAMETERS,"Elements must be numbers"));f=b[0];var a=b[1],g=b[2];!y(a)&&!y(g)?a=g=Math.sqrt(f.length):!y(a)&&z(g)?a=f.length/g:z(a)&&!y(g)&&(g=f.length/a);(!z(a)||!z(g))&&c(new t(u.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given"));d=a;e=g}else 1===b.length&&
z(b[0])?(d=b[0],e=b[0],f=A(d*e,0)):2===b.length&&z(b[0])&&z(b[1])?(d=b[0],e=b[1],f=A(d*e,0)):c(new t(u.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}q("Matrix",w);
function B(a){[].slice.call(arguments);var b,d=[],e=[],f=[];this.b=function(a,b){for(var k=f[a-1];k<f[a];k++)if(e[k]===b)return d[k];return 0};this.c=function(a,b,k){var s=f[a];d.splice(s,0,k);for(e.splice(s,0,b);a<f.length;a++)f[a]+=1;return this};this.rows=function(){return f.length-1};this.a=function(){return b};d=[1,2,3];e=[1,2,3];f=[0,1,2,3];b=3;return this}q("SparseMatrix",B);
q("Vector",function(a){[].slice.call(arguments);var b=[];this.b=function(a,e){return b[e-1]};this.c=function(a,e,f){b[e-1]=f;return this};this.rows=function(){return 1};this.a=function(){return b.length};return this});var C={stringify:{S:"\r\n",C:"\t"},j:{mode:"both"},k:{G:0},o:{which:"max"},random:{O:0,N:1,P:l}};w.options=C;w.prototype.get=function(a,b){this.d(a,b)||c(new t(u.OUT_OF_BOUNDS));return this.b(a,b)};w.prototype.get=w.prototype.get;
w.prototype.set=function(a,b,d){this.d(a,b)||c(new t(u.OUT_OF_BOUNDS));y(d)||c(new t(u.INVALID_PARAMETERS,"Value has to be a number"));return this.c(a,b,d)};w.prototype.set=w.prototype.set;w.prototype.K=function(a,b){b=D(b,n);this.d(a,m)||c(new t(u.OUT_OF_BOUNDS));return F(this,a,b)};w.prototype.getRow=w.prototype.K;function F(a,b,d){for(var e=[],f=a.a(),h=1;h<=f;h++)e.push(a.b(b,h));return d?new w(e,1):e}
w.prototype.U=function(a,b){b=G(b);this.d(a,m)||c(new t(u.OUT_OF_BOUNDS));b.length!==this.a()&&c(new t(u.INVALID_PARAMETERS,"Wrong number of columns in row."));return H(this,a,b)};w.prototype.setRow=w.prototype.U;function H(a,b,d){for(var e=a.a(),f=1;f<=e;f++)a.c(b,f,d[f-1]);return a}w.prototype.J=function(a,b){b=D(b,n);this.d(m,a)||c(new t(u.OUT_OF_BOUNDS));return I(this,a,b)};w.prototype.getColumn=w.prototype.J;
function I(a,b,d){for(var e=[],f=a.rows(),h=1;h<=f;h++)e.push(a.b(h,b));return d?new w(e,m,1):e}w.prototype.T=function(a,b){b=G(b);this.d(m,a)||c(new t(u.OUT_OF_BOUNDS));b.length!==this.rows()&&c(new t(u.INVALID_PARAMETERS,"Wrong number of rows in column"));return J(this,a,b)};w.prototype.setColumn=w.prototype.T;function J(a,b,d){for(var e=a.rows(),f=1;f<=e;f++)a.c(f,b,d[f-1]);return a}w.prototype.i=function(a){return this.rows()===a.rows()&&this.a()===a.a()};w.prototype.isSameSizeAs=w.prototype.i;
w.prototype.L=function(){return this instanceof B};w.prototype.isSparse=w.prototype.L;w.prototype.g=function(){return 1===this.n("min")};w.prototype.isVector=w.prototype.g;w.prototype.f=function(){return this.rows()===this.a()};w.prototype.isSquare=w.prototype.f;w.prototype.M=function(){this.f()||c(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=2;b<=a;b++)for(var d=1;d<b;d++)if(this.b(b,d)!==this.b(d,b))return n;return l};w.prototype.isSymmetric=w.prototype.M;
w.prototype.j=function(a){a=K(a,C.j.mode);this.f()||c(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return L(this,n);case "upper":return L(this,l);case "both":return L(this,l)||L(this,n);default:c(new t(u.INVALID_PARAMETERS,"Mode not supported"))}};w.prototype.isTriangular=w.prototype.j;function L(a,b){for(var d=b?1:-1,e,f,h=a.rows(),g=1;g<h;g++){e=a.diag(d*g);f=e.length;for(var k=0;k<f;k++)if(0!==e[k])return n}return l}
w.prototype.copy=function(){return new w(this.v(),this.rows(),this.a())};w.prototype.copy=w.prototype.copy;w.prototype.size=function(){return this.rows()*this.a()};w.prototype.size=w.prototype.size;w.prototype.n=function(a){switch(a){case 1:case "rows":return this.rows();case 2:case "columns":return this.a();case "max":return Math.max(this.rows(),this.a());case "min":return Math.min(this.rows(),this.a());default:c(new t(u.INVALID_PARAMETERS,"Parameter must match a known value"))}};
w.prototype.dim=w.prototype.n;w.prototype.add=function(a){var b=this.rows(),d=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.add.apply(this.add(b.shift()),b);this.i(a)||c(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new w(b,d),f,h,g=1;g<=b;g++){f=F(this,g,n);h=F(a,g,n);for(var k=0;k<d;k++)f[k]+=h[k];H(e,g,f)}return e};w.prototype.add=w.prototype.add;
w.prototype.p=function(a){var b=this.rows(),d=this.a();if(1<arguments.length)return b=[].slice.call(arguments),this.p.apply(this.p(b.shift()),b);this.i(a)||c(new t(u.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var e=new w(b,d),f,h,g=1;g<=b;g++){f=F(this,g,n);h=F(a,g,n);for(var k=0;k<d;k++)f[k]-=h[k];H(e,g,f)}return e};w.prototype.subtract=w.prototype.p;
w.prototype.scale=function(a){y(a)||c(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=this.rows(),d=this.a(),e=new w(b,d),f,h=1;h<=b;h++){f=F(this,h,n);for(var g=0;g<d;g++)f[g]*=a;H(e,h,f)}return e};w.prototype.scale=w.prototype.scale;
w.prototype.multiply=function(a){var b=this.rows(),d=this.a(),e=a.a();d!==a.rows()&&c(new t(u.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var f=new w(b,e),h=1;h<=b;h++)for(var g=1;g<=e;g++){for(var k=0,s=F(this,h,n),v=I(a,g,n),E=0;E<d;E++)k+=s[E]*v[E];f.c(h,g,k)}return f};w.prototype.multiply=w.prototype.multiply;w.prototype.w=function(){for(var a=this.rows(),b=new w(this.a(),a),d=1;d<=a;d++)J(b,d,F(this,d,n));return b};w.prototype.transpose=w.prototype.w;
w.prototype.trace=function(){this.f()||c(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=this.rows(),b=0,d=1;d<=a;d++)b+=this.b(d,d);return b};w.prototype.trace=w.prototype.trace;
w.prototype.m=function(){var a=0,b=this.copy(),d,e,f,h,g,k=this.rows(),s=this.a(),v;for(f=1;f<=k;f++){e=0;g=-1;h=I(b,f,n);for(d=f;d<=k;d++)v=Math.abs(h[d-1]),v>=g&&(e=d,g=v);0===h[e-1]&&c(new t(u.MATRIX_IS_SINGULAR));e!==f&&(d=F(b,e,n),H(b,e,F(b,f,n)),H(b,f,d),a++);h=F(b,f,n);for(d=f+1;d<=k;d++){g=F(b,d,n);for(e=f;e<s;e++)g[e]-=h[e]*g[f-1]/h[f-1];g[f-1]=0;H(b,d,g)}}b.W=a;return b};w.prototype.decomposeLU=w.prototype.m;
w.prototype.F=function(){var a,b,d,e=this.rows();this.f()||c(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));if(this.j())b=1,d=this.diag();else{try{a=this.m()}catch(f){if(f.code&&f.code===u.MATRIX_IS_SINGULAR)return 0;c(f)}b=Math.pow(-1,a.W);d=a.diag()}for(a=0;a<e;a++)b*=d[a];return b};w.prototype.det=w.prototype.F;
w.prototype.inverse=function(){this.f()||c(new t(u.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.l(M(this.rows())),b,d,e,f,h,g,k,s,v;try{a=a.m();s=a.rows();v=a.a();for(f=s;1<f;f--){d=F(a,f-1,n);b=F(a,f,n);k=d[f-1]/b[f-1];e=[];for(g=0;g<v;g++)e[g]=d[g]-b[g]*k;H(a,f-1,e)}for(h=1;h<=s;h++){b=F(a,h,n);e=[];for(g=0;g<v;g++)e[g]=b[g]/b[h-1];H(a,h,e)}}catch(E){c(new t(u.MATRIX_IS_SINGULAR))}return a.u(1,s,this.a()+1,v)};w.prototype.inverse=w.prototype.inverse;
w.prototype.u=function(a,b,d,e){(!this.d(a,d)||!this.d(b,e)||a>b||d>e)&&c(new t(u.OUT_OF_BOUNDS));for(var f=new w(b-a+1,e-d+1),h=a;h<=b;h++)H(f,h-a+1,F(this,h,n).slice(d-1,e));return f};w.prototype.submatrix=w.prototype.u;w.prototype.l=function(a){var b=this.rows(),d=this.a(),e=a.a();b!==a.rows()&&c(new t(u.INVALID_PARAMETERS,"Number of rows must match"));for(var b=new w(b,d+e),f=1;f<=d;f++)J(b,f,I(this,f,n));for(f=1;f<=e;f++)J(b,f+d,I(a,f,n));return b};w.prototype.augment=w.prototype.l;
w.prototype.H=function(a){var b=this.rows();(!this.g()||!a.g()||1!==this.a()||1!==a.a())&&c(new t(u.INVALID_PARAMETERS,"Parameter must be a column vector"));b!==a.rows()&&c(new t(u.DIMENSION_MISMATCH));for(var d=0,e=1;e<=b;e++)d+=this.b(e,1)*a.b(e,1);return d};w.prototype.dot=w.prototype.H;w.prototype.round=function(){return this.k(0)};w.prototype.round=w.prototype.round;w.prototype.k=function(a){a=y(a)?a:C.k.G;var b=Math.pow(10,a);return this.e(function(a){return Math.round(a*b)/b})};
w.prototype.roundTo=w.prototype.k;w.prototype.abs=function(){return this.e(function(a){return Math.abs(a)})};w.prototype.abs=w.prototype.abs;w.prototype.D=function(a){(!this.g()||!a.g()||3!==this.rows()||3!==a.rows())&&c(new t(u.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return new w([[this.b(2,1)*a.b(3,1)-this.b(3,1)*a.b(2,1)],[this.b(3,1)*a.b(1,1)-this.b(1,1)*a.b(3,1)],[this.b(1,1)*a.b(2,1)-this.b(2,1)*a.b(1,1)]])};w.prototype.cross=w.prototype.D;
w.prototype.B=function(a){a=G(a);for(var b=this.rows(),d=new w(b+1,this.a()),e=1;e<=b;e++)H(d,e,F(this,e,n));H(d,b+1,a);return d};w.prototype.addRow=w.prototype.B;w.prototype.A=function(a){return this.copy().l(new w(G(a),m,1))};w.prototype.addColumn=w.prototype.A;
w.prototype.contains=function(a,b){b=y(b)?b:0;var d=this.rows(),e=this.a(),f;(!y(a)||!y(b))&&c(new t(u.INVALID_PARAMETERS,"Parameter must be a number"));for(var h=1;h<=d;h++){f=F(this,h,n);for(var g=0;g<e;g++)if(0===b){if(f[g]===a)return l}else if(Math.abs(f[g]-a)<=b)return l}return n};w.prototype.contains=w.prototype.contains;w.prototype.stringify=function(a,b){a=K(a,C.stringify.S);b=K(b,C.stringify.C);for(var d=[],e,f=this.rows(),h=1;h<=f;h++)e=F(this,h,n),d.push(e.join(b));return d.join(a)};
w.prototype.stringify=w.prototype.stringify;w.prototype.I=function(a){var b=this.rows(),d=this.a(),e,f;if(!this.i(a))return n;for(var h=1;h<=b;h++){e=F(this,h,n);f=F(a,h,n);for(var g=0;g<d;g++)if(e[g]!==f[g])return n}return l};w.prototype.equals=w.prototype.I;
w.prototype.e=function(a,b){b=b||N.all;"function"!==typeof a&&c(new t(u.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&c(new t(u.INVALID_PARAMETERS,"Filter must be a function"));for(var d,e,f=this.rows(),h=this.a(),g=new w(f,h),k=1;k<=f;k++){e=F(this,k,n);for(var s=1;s<=h;s++)d=e[s-1],b(d,k,s)&&(e[s-1]=a(d,k,s));H(g,k,e)}return g};w.prototype.fun=w.prototype.e;w.prototype.V=function(a){return this.e(a,N.nonZero)};w.prototype.spfun=w.prototype.V;
w.prototype.Q=function(){return this.e(O.exp,m)};w.prototype.pw_exp=w.prototype.Q;w.prototype.R=function(a){return this.e(function(b){return Math.pow(b,a)},m)};w.prototype.pw_pow=w.prototype.R;
w.prototype.o=function(a,b){a=K(a,C.o.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.h(Number(b));case "frobenius":return this.h(2);case "rows":case "rowsum":return this.t();case "columns":case "columnsum":return this.r();case "max":return this.s();default:c(new t(u.INVALID_PARAMETERS,"Norm not supported"))}};w.prototype.norm=w.prototype.o;
w.prototype.h=function(a){z(a)||c(new t(u.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,d=this.rows(),e=this.a(),f,h=1;h<=d;h++){f=F(this,h,n);for(var g=0;g<e;g++)b+=Math.pow(Math.abs(f[g]),a)}return Math.pow(b,1/a)};w.prototype.pnorm=w.prototype.h;w.prototype.s=function(){for(var a=0,b=this.rows(),d=this.a(),e,f=1;f<=b;f++){e=F(this,f,n);for(var h=0;h<d;h++)a=Math.max(a,Math.abs(e[h]))}return a};w.prototype.maxnorm=w.prototype.s;
w.prototype.t=function(){for(var a=0,b=this.rows(),d=1;d<=b;d++)a=Math.max(a,F(this,d,l).h(1));return a};w.prototype.rownorm=w.prototype.t;w.prototype.r=function(){for(var a=0,b=this.a(),d=1;d<=b;d++)a=Math.max(a,I(this,d,l).h(1));return a};w.prototype.columnnorm=w.prototype.r;w.prototype.diag=function(a){a=y(a)?a:0;var b=[],d=-Math.min(a,0);a=Math.max(a,0);var e=0===d?this.a()-a:this.rows()-d;0>=e&&c(new t(u.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(this.b(f+d,f+a));return b};
w.prototype.diag=w.prototype.diag;w.prototype.d=function(a,b){return(!y(a)||1<=a&&a<=this.rows())&&(!y(b)||1<=b&&b<=this.a())};w.prototype.isInRange=w.prototype.d;w.prototype.v=function(){return[].slice.call(this.z())};w.prototype.toArray=w.prototype.v;w.zeros=function(a,b){b=y(b)?b:a;return new w(a,b)};w.ones=function(a,b){b=y(b)?b:a;for(var d=new w(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)d.c(e,f,1);return d};function M(a){for(var b=new w(a,a),d=1;d<=a;d++)b.c(d,d,1);return b}w.eye=M;
w.diag=function(a,b){a=G(a);b=y(b)?b:0;for(var d=new w(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),h=d.rows()-Math.abs(b),g=1;g<=h;g++)d.c(g+e,g+f,a[g-1]);return d};w.diag=w.diag;w.random=function(a,b,d,e,f){b=y(b)?b:a;d=y(d)?d:C.random.O;e=y(e)?e:C.random.N;f=D(f,C.random.P);var h=new w(a,b);e=e-d+(f?1:0);for(var g,k=1;k<=a;k++)for(var s=1;s<=b;s++)g=d+Math.random()*e,f&&(g|=0),h.c(k,s,g);return h};function y(a){return"number"===typeof a}function z(a){return y(a)&&(a|0)===a}
function x(a){for(var b=0;b<a.length;b++)if(!y(a[b]))return n;return l}r.linspace=function(a,b,d){d=y(d)?d:1;for(var e=[];a<=b;a+=d)e.push(a);return e};function A(a,b){for(var d=[],e=1;e<=a;e++)d[e-1]=b;return d}r.repeat=A;function G(a){if(!(a instanceof w))return a;a.g()||c(new t(u.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.n("max")!==a.rows()&&(b=b.w());a=[];for(var d=b.rows(),e=1;e<=d;e++)a.push(b.b(e,1));return a}function K(a,b){return"string"===typeof a?a:b}
function D(a,b){return"boolean"===typeof a?a:b}var N={all:function(){return l},nonZero:function(a){return 0!==a},diag:function(a,b,d){return b===d}};r.filters=N;var O={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};r.applicators=O;Array.prototype.q=function(a,b){return new w(this,a,b)};q("Array.prototype.toMatrix",Array.prototype.q);Array.prototype.X=function(a){a=D(a,n);return new w(this,a?1:this.length,a?this.length:1)};q("Array.prototype.toVector",Array.prototype.X);
String.prototype.q=function(a,b){a=K(a,"\r\n");b=K(b,"\t");for(var d=this.split(a),e,f=0,h=new w(0),g=0;g<d.length;g++){e=d[g].split(b);0===f&&(f=e.length,h=new w(d.length,f));e.length!==f&&c(new t(u.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var k=1;k<=f;k++)h.c(g+1,k,Number(e[k-1]))}return h};q("String.prototype.toMatrix",String.prototype.q);
