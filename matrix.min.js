function d(a){throw a;}var g=!0,k=null,l=!1,m=this;Math.random();function p(a,b){var c=a.split("."),e=m;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var f;c.length&&(f=c.shift());)!c.length&&void 0!==b?e[f]=b:e=e[f]?e[f]:e[f]={}};function q(a){var b=[].slice.call(arguments),c,e,f=[];this.t=function(a){return f[a]};this.u=function(a,b){f[a]=b;return this};this.s=function(){return{rows:c,i:e}};(function(){if(1===b.length&&b[0]instanceof Array&&0!==b[0].length&&b[0][0]instanceof Array){c=b[0].length;e=-1;for(var a=0;a<b[0].length;a++){b[0][a].length!==e&&-1!==e&&d(new r(s.INVALID_PARAMETERS,"Number of columns must be the same for all rows"));t(b[0][a])||d(new r(s.INVALID_PARAMETERS,"Elements must be numbers"));e=Math.max(e,b[0][a].length);
for(var n=0;n<b[0][a].length;n++)f.push(b[0][a][n])}}else 1<=b.length&&3>=b.length&&b[0]instanceof Array&&(0===b[0].length||u(b[0][0]))?(t(b[0])||d(new r(s.INVALID_PARAMETERS,"Elements must be numbers")),f=b[0],a=b[1],n=b[2],!u(a)&&!u(n)?a=n=Math.sqrt(f.length):!u(a)&&v(n)?a=f.length/n:v(a)&&!u(n)&&(n=f.length/a),(!v(a)||!v(n))&&d(new r(s.OUT_OF_BOUNDS,"Array must represent square matrix if no size is given")),c=a,e=n):1===b.length&&v(b[0])?(c=b[0],e=b[0],f=w(c*e,0)):2===b.length&&v(b[0])&&v(b[1])?
(c=b[0],e=b[1],f=w(c*e,0)):d(new r(s.INVALID_PARAMETERS,"Parameters must match a supported signature"))})();return this}p("Matrix",q);var x={stringify:{O:"\r\n",z:"\t"},f:{mode:"both"},g:{C:0},k:{which:"max"},random:{K:0,J:1,L:g}};q.options=x;q.prototype.get=function(a,b){y(this,a,b)||d(new r(s.OUT_OF_BOUNDS));return z(this,a,b)};q.prototype.get=q.prototype.get;
q.prototype.set=function(a,b,c){y(this,a,b)||d(new r(s.OUT_OF_BOUNDS));u(c)||d(new r(s.INVALID_PARAMETERS,"Value has to be a number"));return A(this,a,b,c)};q.prototype.set=q.prototype.set;q.prototype.H=function(a,b){b=B(b,l);y(this,a,k)||d(new r(s.OUT_OF_BOUNDS));return C(this,a,b)};q.prototype.getRow=q.prototype.H;function C(a,b,c){for(var e=[],f=1;f<=a.a(2);f++)e.push(z(a,b,f));return c?new q(e,1):e}
q.prototype.Q=function(a,b){b=D(b);y(this,a,k)||d(new r(s.OUT_OF_BOUNDS));b.length!==this.a(2)&&d(new r(s.INVALID_PARAMETERS,"Wrong number of columns in row."));return E(this,a,b)};q.prototype.setRow=q.prototype.Q;function E(a,b,c){for(var e=1;e<=a.a(2);e++)A(a,b,e,c[e-1]);return a}q.prototype.G=function(a,b){b=B(b,l);y(this,k,a)||d(new r(s.OUT_OF_BOUNDS));return F(this,a,b)};q.prototype.getColumn=q.prototype.G;
function F(a,b,c){for(var e=[],f=1;f<=a.a(1);f++)e.push(z(a,f,b));return c?new q(e,k,1):e}q.prototype.P=function(a,b){b=D(b);y(this,k,a)||d(new r(s.OUT_OF_BOUNDS));b.length!==this.a(1)&&d(new r(s.INVALID_PARAMETERS,"Wrong number of rows in column"));return H(this,a,b)};q.prototype.setColumn=q.prototype.P;function H(a,b,c){for(var e=1;e<=a.a(1);e++)A(a,e,b,c[e-1]);return a}q.prototype.c=function(){return 1===this.a("min")};q.prototype.isVector=q.prototype.c;
q.prototype.b=function(){return this.a(1)===this.a(2)};q.prototype.isSquare=q.prototype.b;q.prototype.I=function(){this.b()||d(new r(s.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=2;a<=this.a(1);a++)for(var b=1;b<a;b++)if(z(this,a,b)!==z(this,b,a))return l;return g};q.prototype.isSymmetric=q.prototype.I;
q.prototype.f=function(a){a=I(a,x.f.mode);this.b()||d(new r(s.DIMENSION_MISMATCH,"Matrix must be square"));switch(a.toLowerCase()){case "lower":return J(this,l);case "upper":return J(this,g);case "both":return J(this,g)||J(this,l);default:d(new r(s.INVALID_PARAMETERS,"Mode not supported"))}};q.prototype.isTriangular=q.prototype.f;function J(a,b){for(var c=b?1:-1,e,f=1;f<a.a(1);f++){e=a.diag(c*f);for(var h=0;h<e.length;h++)if(0!==e[h])return l}return g}
q.prototype.copy=function(){for(var a=new q(this.a(1),this.a(2)),b=1;b<=this.a(1);b++)E(a,b,C(this,b,l));return a};q.prototype.copy=q.prototype.copy;q.prototype.size=function(){return this.a(1)*this.a(2)};q.prototype.size=q.prototype.size;q.prototype.a=function(a){var b=this.s();switch(a){case 1:case "rows":return b.rows;case 2:case "columns":return b.i;case "max":return Math.max(b.rows,b.i);case "min":return Math.min(b.rows,b.i);default:d(new r(s.INVALID_PARAMETERS,"Parameter must match a known value"))}};
q.prototype.dim=q.prototype.a;q.prototype.add=function(a){if(1<arguments.length){var b=[].slice.call(arguments);return this.add.apply(Object(this.add(b.shift())),Object(b))}(this.a(1)!==a.a(1)||this.a(2)!==a.a(2))&&d(new r(s.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var b=new q(this.a(1),this.a(2)),c=1;c<=this.a(1);c++)for(var e=1;e<=this.a(2);e++)A(b,c,e,z(this,c,e)+z(a,c,e));return b};q.prototype.add=q.prototype.add;
q.prototype.l=function(a){if(1<arguments.length){var b=[].slice.call(arguments);return this.l.apply(Object(this.l(b.shift())),Object(b))}(this.a(1)!==a.a(1)||this.a(2)!==a.a(2))&&d(new r(s.DIMENSION_MISMATCH,"Matrices must be of the same size"));for(var b=new q(this.a(1),this.a(2)),c=1;c<=this.a(1);c++)for(var e=1;e<=this.a(2);e++)A(b,c,e,z(this,c,e)-z(a,c,e));return b};q.prototype.subtract=q.prototype.l;
q.prototype.scale=function(a){u(a)||d(new r(s.INVALID_PARAMETERS,"Parameter must be a number"));for(var b=new q(this.a(1),this.a(2)),c=1;c<=this.a(1);c++)for(var e=1;e<=this.a(2);e++)A(b,c,e,a*z(this,c,e));return b};q.prototype.scale=q.prototype.scale;
q.prototype.multiply=function(a){this.a(2)!==a.a(1)&&d(new r(s.DIMENSION_MISMATCH,"Inner dimensions must match"));for(var b=new q(this.a(1),a.a(2)),c=1;c<=b.a(1);c++)for(var e=1;e<=b.a(2);e++){for(var f=0,h=1;h<=this.a(2);h++)f+=z(this,c,h)*z(a,h,e);A(b,c,e,f)}return b};q.prototype.multiply=q.prototype.multiply;q.prototype.r=function(){for(var a=new q(this.a(2),this.a(1)),b=1;b<=this.a(1);b++)H(a,b,C(this,b,l));return a};q.prototype.transpose=q.prototype.r;
q.prototype.trace=function(){this.b()||d(new r(s.DIMENSION_MISMATCH,"Matrix must be square"));for(var a=0,b=1;b<=this.a(1);b++)a+=z(this,b,b);return a};q.prototype.trace=q.prototype.trace;
q.prototype.j=function(){var a=0,b=this.copy(),c,e,f;for(f=1;f<=this.a(1);f++){e=0;var h=-1;for(c=f;c<=this.a(1);c++){var n=Math.abs(z(b,c,f));n>=h&&(e=c,h=n)}0===z(b,e,f)&&d(new r(s.MATRIX_IS_SINGULAR));e!==f&&(c=C(b,e,l),E(b,e,C(b,f,l)),E(b,f,c),a++);for(c=f+1;c<=this.a(1);c++){for(e=f+1;e<=this.a(2);e++)A(b,c,e,z(b,c,e)-z(b,f,e)*(z(b,c,f)/z(b,f,f)));A(b,c,f,0)}}b.S=a;return b};q.prototype.decomposeLU=q.prototype.j;
q.prototype.B=function(){var a,b;this.b()||d(new r(s.DIMENSION_MISMATCH,"Matrix must be square"));if(this.f())for(a=b=1;a<=this.a(1);a++)b*=z(this,a,a);else{try{var c=this.j()}catch(e){if(e.code&&e.code===s.MATRIX_IS_SINGULAR)return 0;d(e)}b=Math.pow(-1,c.S);for(a=1;a<=this.a(1);a++)b*=z(c,a,a)}return b};q.prototype.det=q.prototype.B;
q.prototype.inverse=function(){this.b()||d(new r(s.DIMENSION_MISMATCH,"Matrix must be square"));var a=this.h(K(this.a(1))),b,c,e,f;try{a=a.j();for(c=a.a(1);1<c;c--){b=C(a,c,l);var h=z(a,c-1,c)/z(a,c,c);for(f=0;f<b.length;f++)A(a,c-1,f+1,z(a,c-1,f+1)-b[f]*h)}for(e=1;e<=a.a(1);e++){b=C(a,e,l);for(f=0;f<b.length;f++)b[f]/=z(a,e,e);E(a,e,b)}}catch(n){d(new r(s.MATRIX_IS_SINGULAR))}return a.q(1,a.a(1),this.a(2)+1,a.a(2))};q.prototype.inverse=q.prototype.inverse;
q.prototype.q=function(a,b,c,e){(!y(this,a,c)||!y(this,b,e)||a>b||c>e)&&d(new r(s.OUT_OF_BOUNDS));for(var f=new q(b-a+1,e-c+1),h=a;h<=b;h++){var n=C(this,h,l).slice(c-1,e);E(f,h-a+1,n)}return f};q.prototype.submatrix=q.prototype.q;q.prototype.h=function(a){this.a(1)!==a.a(1)&&d(new r(s.INVALID_PARAMETERS,"Number of rows must match"));for(var b=new q(this.a(1),this.a(2)+a.a(2)),c=1;c<=this.a(2);c++)H(b,c,F(this,c,l));for(c=1;c<=a.a(2);c++)H(b,c+this.a(2),F(a,c,l));return b};q.prototype.augment=q.prototype.h;
q.prototype.D=function(a){(!this.c()||!a.c()||1!==this.a(2)||1!==a.a(2))&&d(new r(s.INVALID_PARAMETERS,"Parameter must be a column vector"));this.a(1)!==a.a(1)&&d(new r(s.DIMENSION_MISMATCH));for(var b=0,c=1;c<=this.a(1);c++)b+=z(this,c,1)*z(a,c,1);return b};q.prototype.dot=q.prototype.D;q.prototype.round=function(){return this.g(0)};q.prototype.round=q.prototype.round;
q.prototype.g=function(a){a=u(a)?a:x.g.C;var b=this.copy();a=Math.pow(10,a);for(var c=1;c<=b.a(1);c++)for(var e=1;e<=b.a(2);e++)A(b,c,e,Math.round(z(b,c,e)*a)/a);return b};q.prototype.roundTo=q.prototype.g;q.prototype.abs=function(){for(var a=this.copy(),b=1;b<=a.a(1);b++)for(var c=1;c<=a.a(2);c++)A(a,b,c,Math.abs(z(a,b,c)));return a};q.prototype.abs=q.prototype.abs;
q.prototype.A=function(a){(!this.c()||!a.c()||3!==this.a(1)||3!==a.a(1))&&d(new r(s.INVALID_PARAMETERS,"Parameters must be three-dimensional column vectors"));return new q([[z(this,2,1)*z(a,3,1)-z(this,3,1)*z(a,2,1)],[z(this,3,1)*z(a,1,1)-z(this,1,1)*z(a,3,1)],[z(this,1,1)*z(a,2,1)-z(this,2,1)*z(a,1,1)]])};q.prototype.cross=q.prototype.A;q.prototype.w=function(a){a=D(a);for(var b=new q(this.a(1)+1,this.a(2)),c=1;c<=this.a(1);c++)E(b,c,C(this,c,l));E(b,this.a(1)+1,a);return b};q.prototype.addRow=q.prototype.w;
q.prototype.v=function(a){return this.copy().h(new q(D(a),k,1))};q.prototype.addColumn=q.prototype.v;q.prototype.contains=function(a,b){b=u(b)?b:0;(!u(a)||!u(b))&&d(new r(s.INVALID_PARAMETERS,"Parameter must be a number"));for(var c=1;c<=this.a(1);c++)for(var e=1;e<=this.a(2);e++)if(0===b){if(z(this,c,e)===a)return g}else if(Math.abs(z(this,c,e)-a)<=b)return g;return l};q.prototype.contains=q.prototype.contains;
q.prototype.stringify=function(a,b){a=I(a,x.stringify.O);b=I(b,x.stringify.z);for(var c=[],e,f=1;f<=this.a(1);f++){e=[];for(var h=1;h<=this.a(2);h++)e.push(z(this,f,h));c.push(e.join(b))}return c.join(a)};q.prototype.stringify=q.prototype.stringify;q.prototype.F=function(a){if(this.a(1)!==a.a(1)||this.a(2)!==a.a(2))return l;for(var b=1;b<=this.a(1);b++)for(var c=1;c<=this.a(2);c++)if(z(this,b,c)!==z(a,b,c))return l;return g};q.prototype.equals=q.prototype.F;
q.prototype.e=function(a,b){b=b||L.all;"function"!==typeof a&&d(new r(s.INVALID_PARAMETERS,"Applicator must be a function"));"function"!==typeof b&&d(new r(s.INVALID_PARAMETERS,"Filter must be a function"));for(var c=this.copy(),e,f=1;f<=c.a(1);f++)for(var h=1;h<=c.a(2);h++)e=z(c,f,h),b(e,f,h)&&A(c,f,h,a(e,f,h));return c};q.prototype.fun=q.prototype.e;q.prototype.R=function(a){return this.e(a,L.nonZero)};q.prototype.spfun=q.prototype.R;q.prototype.M=function(){return this.e(M.exp,k)};
q.prototype.pw_exp=q.prototype.M;q.prototype.N=function(a){return this.e(function(b){return Math.pow(b,a)},k)};q.prototype.pw_pow=q.prototype.N;q.prototype.k=function(a,b){a=I(a,x.k.which);b=b||{};switch(a.toLowerCase()){case "p":case "pnorm":return this.d(Number(b));case "frobenius":return this.d(2);case "rows":case "rowsum":return this.p();case "columns":case "columnsum":return this.n();case "max":return this.o();default:d(new r(s.INVALID_PARAMETERS,"Norm not supported"))}};q.prototype.norm=q.prototype.k;
q.prototype.d=function(a){v(a)||d(new r(s.INVALID_PARAMETERS,"Parameter must be an integer"));for(var b=0,c=1;c<=this.a(1);c++)for(var e=1;e<=this.a(2);e++)b+=Math.pow(Math.abs(z(this,c,e)),a);return Math.pow(b,1/a)};q.prototype.pnorm=q.prototype.d;q.prototype.o=function(){for(var a=0,b=1;b<=this.a(1);b++)for(var c=1;c<=this.a(2);c++)a=Math.max(a,Math.abs(z(this,b,c)));return a};q.prototype.maxnorm=q.prototype.o;
q.prototype.p=function(){for(var a=0,b=1;b<=this.a(1);b++)a=Math.max(a,C(this,b,g).d(1));return a};q.prototype.rownorm=q.prototype.p;q.prototype.n=function(){for(var a=0,b=1;b<=this.a(2);b++)a=Math.max(a,F(this,b,g).d(1));return a};q.prototype.columnnorm=q.prototype.n;q.prototype.diag=function(a){a=u(a)?a:0;var b=[],c=-Math.min(a,0);a=Math.max(a,0);var e=0===c?this.a(2)-a:this.a(1)-c;0>=e&&d(new r(s.OUT_OF_BOUNDS));for(var f=1;f<=e;f++)b.push(z(this,f+c,f+a));return b};q.prototype.diag=q.prototype.diag;
Array.prototype.m=function(a,b){return new q(this,a,b)};p("Array.prototype.toMatrix",Array.prototype.m);Array.prototype.T=function(a){a=B(a,l);return new q(this,a?1:this.length,a?this.length:1)};p("Array.prototype.toVector",Array.prototype.T);
String.prototype.m=function(a,b){a=I(a,"\r\n");b=I(b,"\t");for(var c=this.split(a),e,f=0,h=new q(0),n=0;n<c.length;n++){e=c[n].split(b);0===f&&(f=e.length,h=new q(c.length,f));e.length!==f&&d(new r(s.INVALID_PARAMETERS,"Number of columns is inconsistent"));for(var G=1;G<=f;G++)A(h,n+1,G,Number(e[G-1]))}return h};p("String.prototype.toMatrix",String.prototype.m);function z(a,b,c){return a.t(a.a(2)*(b-1)+c-1)}function A(a,b,c,e){return a.u(a.a(2)*(b-1)+c-1,e)}
function y(a,b,c){return(!u(b)||1<=b&&b<=a.a(1))&&(!u(c)||1<=c&&c<=a.a(2))}function u(a){return"number"===typeof a}function v(a){return u(a)&&(a|0)===a}function t(a){for(var b=0;b<a.length;b++)if(!u(a[b]))return l;return g}function D(a){if(!(a instanceof q))return a;a.c()||d(new r(s.DIMENSION_MISMATCH,"Argument has to be vector"));var b=a.copy();a.a("max")!==a.a(1)&&(b=b.r());a=[];for(var c=1;c<=b.a(1);c++)a.push(z(b,c,1));return a}function I(a,b){return"string"===typeof a?a:b}
function B(a,b){return"boolean"===typeof a?a:b}function r(a,b){this.name="MatrixError";this.code=a;this.message=b;this.toString=function(){return this.name+" ["+this.code+"]: "+(this.message||"No message")}}q.MatrixError=r;var s={INVALID_PARAMETERS:"Invalid parameters",OUT_OF_BOUNDS:"Out of bounds",DIMENSION_MISMATCH:"Dimension mismatch",MATRIX_IS_SINGULAR:"Matrix is singular"};q.ErrorCodes=s;var L={all:function(){return g},nonZero:function(a){return 0!==a},diag:function(a,b,c){return b===c}};
q.filters=L;var M={exp:function(a){return Math.exp(a)},square:function(a){return a*a}};q.applicators=M;q.zeros=function(a,b){b=u(b)?b:a;return new q(a,b)};q.ones=function(a,b){b=u(b)?b:a;for(var c=new q(a,b),e=1;e<=a;e++)for(var f=1;f<=b;f++)A(c,e,f,1);return c};function K(a){for(var b=new q(a,a),c=1;c<=a;c++)A(b,c,c,1);return b}q.eye=K;q.diag=function(a,b){a=D(a);b=u(b)?b:0;for(var c=new q(a.length+Math.abs(b)),e=-Math.min(b,0),f=Math.max(b,0),h=1;h<=c.a(1)-Math.abs(b);h++)A(c,h+e,h+f,a[h-1]);return c};
q.diag=q.diag;q.random=function(a,b,c,e,f){b=u(b)?b:a;c=u(c)?c:x.random.K;e=u(e)?e:x.random.J;f=B(f,x.random.L);a=new q(a,b);e=e-c+(f?1:0);for(var h=1;h<=a.a(1);h++)for(var n=1;n<=a.a(2);n++)b=c+Math.random()*e,f&&(b|=0),A(a,h,n,b);return a};q.linspace=function(a,b,c){c=u(c)?c:1;for(var e=[];a<=b;a+=c)e.push(a);return e};function w(a,b){for(var c=[],e=1;e<=a;e++)c[e-1]=b;return c}q.repeat=w;
